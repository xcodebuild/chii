export function defineCommonExtensionSymbols(e){e.panels||(e.panels={}),e.panels.SearchAction={CancelSearch:"cancelSearch",PerformSearch:"performSearch",NextSearchResult:"nextSearchResult",PreviousSearchResult:"previousSearchResult"},e.Events={ButtonClicked:"button-clicked-",PanelObjectSelected:"panel-objectSelected-",NetworkRequestFinished:"network-request-finished",OpenResource:"open-resource",PanelSearch:"panel-search-",RecordingStarted:"trace-recording-started-",RecordingStopped:"trace-recording-stopped-",ResourceAdded:"resource-added",ResourceContentCommitted:"resource-content-committed",ViewShown:"view-shown-",ViewHidden:"view-hidden-"},e.Commands={AddRequestHeaders:"addRequestHeaders",AddTraceProvider:"addTraceProvider",ApplyStyleSheet:"applyStyleSheet",CompleteTraceSession:"completeTraceSession",CreatePanel:"createPanel",CreateSidebarPane:"createSidebarPane",CreateToolbarButton:"createToolbarButton",EvaluateOnInspectedPage:"evaluateOnInspectedPage",ForwardKeyboardEvent:"_forwardKeyboardEvent",GetHAR:"getHAR",GetPageResources:"getPageResources",GetRequestContent:"getRequestContent",GetResourceContent:"getResourceContent",InspectedURLChanged:"inspectedURLChanged",OpenResource:"openResource",Reload:"Reload",Subscribe:"subscribe",SetOpenResourceHandler:"setOpenResourceHandler",SetResourceContent:"setResourceContent",SetSidebarContent:"setSidebarContent",SetSidebarHeight:"setSidebarHeight",SetSidebarPage:"setSidebarPage",ShowPanel:"showPanel",Unsubscribe:"unsubscribe",UpdateButton:"updateButton"}}self.injectedExtensionAPI=function(e,t,n,o,s,i){const r=new Set(o),c=window.chrome||{};if(Object.getOwnPropertyDescriptor(c,"devtools"))return;const d={};defineCommonExtensionSymbols(d);const a=d.Commands,u=d.Events;let l=!1;function p(e,t){this._type=e,this._listeners=[],this._customDispatch=t}function h(){this.onRequestFinished=new S(u.NetworkRequestFinished,(function(e){const t=e.arguments[1];t.__proto__=new q(e.arguments[0]),this._fire(t)})),b(this,"network","onFinished","onRequestFinished"),this.onNavigated=new S(u.InspectedURLChanged)}function f(e){this._id=e}function m(){const e={elements:new I,sources:new k};function t(t){return e[t]}for(const n in e)Object.defineProperty(this,n,{get:t.bind(null,n),enumerable:!0});this.applyStyleSheet=function(e){F.sendRequest({command:a.ApplyStyleSheet,styleSheet:e})}}function _(e){this._id=e,e&&(this.onShown=new S(u.ViewShown+e,(function(e){const t=e.arguments[0];"number"==typeof t?this._fire(window.parent.frames[t]):this._fire()})),this.onHidden=new S(u.ViewHidden+e))}function y(e){_.call(this,null),this._hostPanelName=e,this.onSelectionChanged=new S(u.PanelObjectSelected+e)}function g(e){return function(){const t={__proto__:e.prototype};e.apply(t,arguments),D(this,t)}}function b(e,t,n,o){let s=!1;e.__defineGetter__(n,(function(){return s||(console.warn(t+"."+n+" is deprecated. Use "+t+"."+o+" instead"),s=!0),e[o]}))}function R(e){const t=e[e.length-1];return"function"==typeof t?t:void 0}p.prototype={addListener:function(e){if("function"!=typeof e)throw"addListener: callback is not a function";0===this._listeners.length&&F.sendRequest({command:a.Subscribe,type:this._type}),this._listeners.push(e),F.registerHandler("notify-"+this._type,this._dispatch.bind(this))},removeListener:function(e){const t=this._listeners;for(let n=0;n<t.length;++n)if(t[n]===e){t.splice(n,1);break}0===this._listeners.length&&F.sendRequest({command:a.Unsubscribe,type:this._type})},_fire:function(e){const t=this._listeners.slice();for(let e=0;e<t.length;++e)t[e].apply(null,arguments)},_dispatch:function(e){this._customDispatch?this._customDispatch.call(this,e):this._fire.apply(this,e.arguments)}},h.prototype={getHAR:function(e){F.sendRequest({command:a.GetHAR},e&&function(t){const n=t&&t.entries||[];for(let e=0;e<n.length;++e)n[e].__proto__=new q(n[e]._requestId),delete n[e]._requestId;e(t)})},addRequestHeaders:function(e){F.sendRequest({command:a.AddRequestHeaders,headers:e,extensionId:window.location.hostname})}},f.prototype={getContent:function(e){F.sendRequest({command:a.GetRequestContent,id:this._id},e&&function(t){e(t.content,t.encoding)})}},m.prototype={create:function(e,t,n,o){const s="extension-panel-"+F.nextObjectId(),i={command:a.CreatePanel,id:s,title:e,icon:t,page:n};F.sendRequest(i,o&&o.bind(this,new C(s)))},setOpenResourceHandler:function(e){const t=F.hasHandler(u.OpenResource);e?F.registerHandler(u.OpenResource,(function(t){l=!0;try{e.call(null,new O(t.resource),t.lineNumber)}finally{l=!1}})):F.unregisterHandler(u.OpenResource),t===!e&&F.sendRequest({command:a.SetOpenResourceHandler,handlerPresent:!!e})},openResource:function(e,t,n){F.sendRequest({command:a.OpenResource,url:e,lineNumber:t},n)},get SearchAction(){return d.panels.SearchAction}},y.prototype={createSidebarPane:function(e,t){const n="extension-sidebar-"+F.nextObjectId(),o={command:a.CreateSidebarPane,panel:this._hostPanelName,id:n,title:e};F.sendRequest(o,t&&function(){t(new P(n))})},__proto__:_.prototype};const w=g(A),S=g(p),C=g(j),P=g(H),v=g(y),q=g(f),O=g(B),x=g(K);class I extends v{constructor(){super("elements")}}class k extends v{constructor(){super("sources")}}function j(e){_.call(this,e),this.onSearch=new S(u.PanelSearch+e)}function H(e){_.call(this,e)}function A(e){this._id=e,this.onClicked=new S(u.ButtonClicked+e)}function E(){}function K(e){this._id=e}function T(e){this.onRecordingStarted=new S(u.RecordingStarted+e,(function(e){const t=e.arguments[0];this._fire(new x(t))})),this.onRecordingStopped=new S(u.RecordingStopped+e)}function N(){this.onResourceAdded=new S(u.ResourceAdded,(function(e){this._fire(new O(e.arguments[0]))})),this.onResourceContentCommitted=new S(u.ResourceContentCommitted,(function(e){this._fire(new O(e.arguments[0]),e.arguments[1])}))}function B(e){this._url=e.url,this._type=e.type}j.prototype={createStatusBarButton:function(e,t,n){const o="button-"+F.nextObjectId(),s={command:a.CreateToolbarButton,panel:this._id,id:o,icon:e,tooltip:t,disabled:!!n};return F.sendRequest(s),new w(o)},show:function(){if(!l)return;const e={command:a.ShowPanel,id:this._id};F.sendRequest(e)},__proto__:_.prototype},H.prototype={setHeight:function(e){F.sendRequest({command:a.SetSidebarHeight,id:this._id,height:e})},setExpression:function(e,t,n){const o={command:a.SetSidebarContent,id:this._id,expression:e,rootTitle:t,evaluateOnPage:!0};"object"==typeof n&&(o.evaluateOptions=n),F.sendRequest(o,R(arguments))},setObject:function(e,t,n){F.sendRequest({command:a.SetSidebarContent,id:this._id,expression:e,rootTitle:t},n)},setPage:function(e){F.sendRequest({command:a.SetSidebarPage,id:this._id,page:e})},__proto__:_.prototype},A.prototype={update:function(e,t,n){const o={command:a.UpdateButton,id:this._id,icon:e,tooltip:t,disabled:!!n};F.sendRequest(o)}},E.prototype={addTraceProvider:function(e,t){const n="extension-trace-provider-"+F.nextObjectId();return F.sendRequest({command:a.AddTraceProvider,id:n,categoryName:e,categoryTooltip:t}),new T(n)}},K.prototype={complete:function(e,t){const n={command:a.CompleteTraceSession,id:this._id,url:e||"",timeOffset:t||0};F.sendRequest(n)}},N.prototype={reload:function(e){let t=null;"object"==typeof e?t=e:"string"==typeof e&&(t={userAgent:e},console.warn("Passing userAgent as string parameter to inspectedWindow.reload() is deprecated. Use inspectedWindow.reload({ userAgent: value}) instead.")),F.sendRequest({command:a.Reload,options:t})},eval:function(e,t){const n=R(arguments);function o(e){e.isError||e.isException?n(void 0,e):n(e.value)}const s={command:a.EvaluateOnInspectedPage,expression:e};return"object"==typeof t&&(s.evaluateOptions=t),F.sendRequest(s,n&&o),null},getResources:function(e){function t(e){return new O(e)}F.sendRequest({command:a.GetPageResources},e&&function(n){e(n.map(t))})}},B.prototype={get url(){return this._url},get type(){return this._type},getContent:function(e){F.sendRequest({command:a.GetResourceContent,url:this._url},e&&function(t){e(t.content,t.encoding)})},setContent:function(e,t,n){F.sendRequest({command:a.SetResourceContent,url:this._url,content:e,commit:t},n)}};let G=[],U=null;function W(){U=null;const e={command:a.ForwardKeyboardEvent,entries:G};F.sendRequest(e),G=[]}function L(){this._callbacks={},this._handlers={},this._lastRequestId=0,this._lastObjectId=0,this.registerHandler("callback",this._onCallback.bind(this));const e=new MessageChannel;this._port=e.port1,this._port.addEventListener("message",this._onMessage.bind(this),!1),this._port.start(),window.parent.postMessage("registerExtension","*",[e.port2])}function D(e,t){for(const n in t){if("_"===n.charAt(0))continue;let o=null;for(let e=t;e&&!o;e=e.__proto__)o=Object.getOwnPropertyDescriptor(e,n);o&&("function"==typeof o.value?e[n]=o.value.bind(t):"function"==typeof o.get?e.__defineGetter__(n,o.get.bind(t)):Object.defineProperty(e,n,o))}}document.addEventListener("keydown",(function(e){const t=document.activeElement;if(t){if(("INPUT"===t.nodeName||"TEXTAREA"===t.nodeName)&&!(e.ctrlKey||e.altKey||e.metaKey))return}let n=0;e.shiftKey&&(n|=1),e.ctrlKey&&(n|=2),e.altKey&&(n|=4),e.metaKey&&(n|=8);const o=255&e.keyCode|n<<8;if(!r.has(o))return;e.preventDefault();const s={eventType:e.type,ctrlKey:e.ctrlKey,altKey:e.altKey,metaKey:e.metaKey,shiftKey:e.shiftKey,keyIdentifier:e.keyIdentifier,key:e.key,code:e.code,location:e.location,keyCode:e.keyCode};G.push(s),U||(U=setTimeout(W,0))}),!1),L.prototype={sendRequest:function(e,t){"function"==typeof t&&(e.requestId=this._registerCallback(t)),this._port.postMessage(e)},hasHandler:function(e){return!!this._handlers[e]},registerHandler:function(e,t){this._handlers[e]=t},unregisterHandler:function(e){delete this._handlers[e]},nextObjectId:function(){return i.toString()+"_"+ ++this._lastObjectId},_registerCallback:function(e){const t=++this._lastRequestId;return this._callbacks[t]=e,t},_onCallback:function(e){if(e.requestId in this._callbacks){const t=this._callbacks[e.requestId];delete this._callbacks[e.requestId],t(e.result)}},_onMessage:function(e){const t=e.data,n=this._handlers[t.command];n&&n.call(this,t)}};const F=new L,M=new function(){this.inspectedWindow=new N,this.panels=new m,this.network=new h,this.timeline=new E,b(this,"webInspector","resources","network")};if(Object.defineProperty(c,"devtools",{value:{},enumerable:!0}),c.devtools.inspectedWindow={},Object.defineProperty(c.devtools.inspectedWindow,"tabId",{get:function(){return t}}),c.devtools.inspectedWindow.__proto__=M.inspectedWindow,c.devtools.network=M.network,c.devtools.panels=M.panels,c.devtools.panels.themeName=n,!1!==e.exposeExperimentalAPIs){c.experimental=c.experimental||{},c.experimental.devtools=c.experimental.devtools||{};const e=Object.getOwnPropertyNames(M);for(let t=0;t<e.length;++t){const n=Object.getOwnPropertyDescriptor(M,e[t]);n&&Object.defineProperty(c.experimental.devtools,e[t],n)}c.experimental.devtools.inspectedWindow=c.devtools.inspectedWindow}e.exposeWebInspectorNamespace&&(window.webInspector=M),s(F,M)},self.buildExtensionAPIInjectedScript=function(e,t,n,o,s){const i=[e,t||null,n,o].map(e=>JSON.stringify(e)).join(",");return s||(s=()=>{}),"(function(injectedScriptId){ "+defineCommonExtensionSymbols.toString()+";("+self.injectedExtensionAPI.toString()+")("+i+","+s+", injectedScriptId);})"};