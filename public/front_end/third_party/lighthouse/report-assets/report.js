/**
 * @license
 * Copyright 2017 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS-IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
"use strict";const ELLIPSIS="…",NBSP=" ",PASS_THRESHOLD=.9,SCREENSHOT_PREFIX="data:image/jpeg;base64,",RATINGS={PASS:{label:"pass",minScore:.9},AVERAGE:{label:"average",minScore:.5},FAIL:{label:"fail"},ERROR:{label:"error"}},listOfTlds=["com","co","gov","edu","ac","org","go","gob","or","net","in","ne","nic","gouv","web","spb","blog","jus","kiev","mil","wi","qc","ca","bel","on"];class Util{static get PASS_THRESHOLD(){return.9}static get MS_DISPLAY_VALUE(){return"%10d ms"}static prepareReportResult(e){const t=JSON.parse(JSON.stringify(e));t.configSettings.locale||(t.configSettings.locale="en");for(const e of Object.values(t.audits))if("not_applicable"!==e.scoreDisplayMode&&"not-applicable"!==e.scoreDisplayMode||(e.scoreDisplayMode="notApplicable"),e.details&&(void 0!==e.details.type&&"diagnostic"!==e.details.type||(e.details.type="debugdata"),"filmstrip"===e.details.type))for(const t of e.details.items)t.data.startsWith(SCREENSHOT_PREFIX)||(t.data=SCREENSHOT_PREFIX+t.data);if(Util.setNumberDateLocale(t.configSettings.locale),t.i18n&&t.i18n.rendererFormattedStrings&&Util.updateAllUIStrings(t.i18n.rendererFormattedStrings),"object"!=typeof t.categories)throw new Error("No categories provided.");for(const e of Object.values(t.categories))e.auditRefs.forEach(e=>{const n=t.audits[e.id];e.result=n,t.stackPacks&&t.stackPacks.forEach(t=>{t.descriptions[e.id]&&(e.stackPacks=e.stackPacks||[],e.stackPacks.push({title:t.title,iconDataURL:t.iconDataURL,description:t.descriptions[e.id]}))})});return t}static updateAllUIStrings(e){for(const[t,n]of Object.entries(e))Util.UIStrings[t]=n}static showAsPassed(e){switch(e.scoreDisplayMode){case"manual":case"notApplicable":return!0;case"error":case"informative":return!1;case"numeric":case"binary":default:return Number(e.score)>=RATINGS.PASS.minScore}}static calculateRating(e,t){if("manual"===t||"notApplicable"===t)return RATINGS.PASS.label;if("error"===t)return RATINGS.ERROR.label;if(null===e)return RATINGS.FAIL.label;let n=RATINGS.FAIL.label;return e>=RATINGS.PASS.minScore?n=RATINGS.PASS.label:e>=RATINGS.AVERAGE.minScore&&(n=RATINGS.AVERAGE.label),n}static formatNumber(e,t=.1){const n=Math.round(e/t)*t;return Util.numberFormatter.format(n)}static formatBytesToKB(e,t=.1){return Util.numberFormatter.format(Math.round(e/1024/t)*t)+" KB"}static formatMilliseconds(e,t=10){const n=Math.round(e/t)*t;return Util.numberFormatter.format(n)+" ms"}static formatSeconds(e,t=.1){const n=Math.round(e/1e3/t)*t;return Util.numberFormatter.format(n)+" s"}static formatDateTime(e){const t={month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",timeZoneName:"short"};let n=new Intl.DateTimeFormat(Util.numberDateLocale,t);const i=n.resolvedOptions().timeZone;return i&&"etc/unknown"!==i.toLowerCase()||(t.timeZone="UTC",n=new Intl.DateTimeFormat(Util.numberDateLocale,t)),n.format(new Date(e))}static formatDuration(e){let t=e/1e3;if(0===Math.round(t))return"None";const n=[],i={d:86400,h:3600,m:60,s:1};return Object.keys(i).forEach(e=>{const r=i[e],s=Math.floor(t/r);s>0&&(t-=s*r,n.push(`${s} ${e}`))}),n.join(" ")}static splitMarkdownCodeSpans(e){const t=[],n=e.split(/`(.*?)`/g);for(let e=0;e<n.length;e++){const i=n[e];if(!i)continue;const r=e%2!=0;t.push({isCode:r,text:i})}return t}static splitMarkdownLink(e){const t=[],n=e.split(/\[([^\]]+?)\]\((https?:\/\/.*?)\)/g);for(;n.length;){const[e,i,r]=n.splice(0,3);e&&t.push({isLink:!1,text:e}),i&&r&&t.push({isLink:!0,text:i,linkHref:r})}return t}static getURLDisplayName(e,t){const n=void 0!==(t=t||{numPathParts:void 0,preserveQuery:void 0,preserveHost:void 0}).numPathParts?t.numPathParts:2,i=void 0===t.preserveQuery||t.preserveQuery,r=t.preserveHost||!1;let s;if("about:"===e.protocol||"data:"===e.protocol)s=e.href;else{s=e.pathname;const t=s.split("/").filter(e=>e.length);n&&t.length>n&&(s="…"+t.slice(-1*n).join("/")),r&&(s=`${e.host}/${s.replace(/^\//,"")}`),i&&(s=`${s}${e.search}`)}if(s=s.replace(/([a-f0-9]{7})[a-f0-9]{13}[a-f0-9]*/g,"$1…"),s=s.replace(/([a-zA-Z0-9-_]{9})(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])[a-zA-Z0-9-_]{10,}/g,"$1…"),s=s.replace(/(\d{3})\d{6,}/g,"$1…"),s=s.replace(/\u2026+/g,"…"),s.length>64&&s.includes("?")&&(s=s.replace(/\?([^=]*)(=)?.*/,"?$1$2…"),s.length>64&&(s=s.replace(/\?.*/,"?…"))),s.length>64){const e=s.lastIndexOf(".");s=e>=0?s.slice(0,63-(s.length-e))+"…"+s.slice(e):s.slice(0,63)+"…"}return s}static parseURL(e){const t=new URL(e);return{file:Util.getURLDisplayName(t),hostname:t.hostname,origin:t.origin}}static createOrReturnURL(e){return e instanceof URL?e:new URL(e)}static getTld(e){const t=e.split(".").slice(-2);return listOfTlds.includes(t[0])?"."+t.join("."):"."+t[t.length-1]}static getRootDomain(e){const t=Util.createOrReturnURL(e).hostname,n=Util.getTld(t).split(".");return t.split(".").slice(-n.length).join(".")}static getEnvironmentDisplayValues(e){const t=Util.getEmulationDescriptions(e);return[{name:"Device",description:t.deviceEmulation},{name:"Network throttling",description:t.networkThrottling},{name:"CPU throttling",description:t.cpuThrottling}]}static getEmulationDescriptions(e){let t,n,i;const r=e.throttling;switch(e.throttlingMethod){case"provided":t="Provided by environment",n="Provided by environment",i="No throttling applied";break;case"devtools":{const{cpuSlowdownMultiplier:e,requestLatencyMs:s}=r;t=Util.formatNumber(e)+"x slowdown (DevTools)",n=Util.formatNumber(s)+" ms HTTP RTT, "+Util.formatNumber(r.downloadThroughputKbps)+" Kbps down, "+Util.formatNumber(r.uploadThroughputKbps)+" Kbps up (DevTools)",i="Throttled Slow 4G network";break}case"simulate":{const{cpuSlowdownMultiplier:e,rttMs:s,throughputKbps:o}=r;t=Util.formatNumber(e)+"x slowdown (Simulated)",n=Util.formatNumber(s)+" ms TCP RTT, "+Util.formatNumber(o)+" Kbps throughput (Simulated)",i="Simulated Slow 4G network";break}default:t="Unknown",n="Unknown",i="Unknown"}let s="No emulation";return"mobile"===e.emulatedFormFactor&&(s="Emulated Nexus 5X"),"desktop"===e.emulatedFormFactor&&(s="Emulated Desktop"),{deviceEmulation:s,cpuThrottling:t,networkThrottling:n,summary:`${s}, ${i}`}}static setNumberDateLocale(e){"en-XA"===e&&(e="de"),Util.numberDateLocale=e,Util.numberFormatter=new Intl.NumberFormat(e)}static filterRelevantLines(e,t,n){if(0===t.length)return e.slice(0,2*n+1);const i=new Set;return(t=t.sort((e,t)=>(e.lineNumber||0)-(t.lineNumber||0))).forEach(({lineNumber:e})=>{let t=e-n,r=e+n;for(;t<1;)t++,r++;i.has(t-3-1)&&(t-=3);for(let e=t;e<=r;e++){const t=e;i.add(t)}}),e.filter(e=>i.has(e.lineNumber))}static isPluginCategory(e){return e.startsWith("lighthouse-plugin-")}}Util.numberDateLocale="en",Util.numberFormatter=new Intl.NumberFormat(Util.numberDateLocale),Util.UIStrings={varianceDisclaimer:"Values are estimated and may vary. The performance score is [based only on these metrics](https://github.com/GoogleChrome/lighthouse/blob/d2ec9ffbb21de9ad1a0f86ed24575eda32c796f0/docs/scoring.md#how-are-the-scores-weighted).",opportunityResourceColumnLabel:"Opportunity",opportunitySavingsColumnLabel:"Estimated Savings",errorMissingAuditInfo:"Report error: no audit information",errorLabel:"Error!",warningHeader:"Warnings: ",auditGroupExpandTooltip:"Show audits",warningAuditsGroupTitle:"Passed audits but with warnings",passedAuditsGroupTitle:"Passed audits",notApplicableAuditsGroupTitle:"Not applicable",manualAuditsGroupTitle:"Additional items to manually check",toplevelWarningsMessage:"There were issues affecting this run of Lighthouse:",crcInitialNavigation:"Initial Navigation",crcLongestDurationLabel:"Maximum critical path latency:",snippetExpandButtonLabel:"Expand snippet",snippetCollapseButtonLabel:"Collapse snippet",lsPerformanceCategoryDescription:"[Lighthouse](https://developers.google.com/web/tools/lighthouse/) analysis of the current page on an emulated mobile network. Values are estimated and may vary.",labDataTitle:"Lab Data",thirdPartyResourcesLabel:"Show 3rd-party resources"},"undefined"!=typeof module&&module.exports?module.exports=Util:self.Util=Util;class DOM{constructor(e){this._document=e,this._lighthouseChannel="unknown"}createElement(e,t,n={}){const i=this._document.createElement(e);return t&&(i.className=t),Object.keys(n).forEach(e=>{const t=n[e];void 0!==t&&i.setAttribute(e,t)}),i}createFragment(){return this._document.createDocumentFragment()}createChildOf(e,t,n,i){const r=this.createElement(t,n,i);return e.appendChild(r),r}cloneTemplate(e,t){const n=t.querySelector(e);if(!n)throw new Error("Template not found: template"+e);const i=this._document.importNode(n.content,!0);return n.hasAttribute("data-stamped")&&this.findAll("style",i).forEach(e=>e.remove()),n.setAttribute("data-stamped","true"),i}resetTemplates(){this.findAll("template[data-stamped]",this._document).forEach(e=>{e.removeAttribute("data-stamped")})}convertMarkdownLinkSnippets(e){const t=this.createElement("span");for(const n of Util.splitMarkdownLink(e)){if(!n.isLink){t.appendChild(this._document.createTextNode(n.text));continue}const e=new URL(n.linkHref);["https://developers.google.com","https://web.dev"].includes(e.origin)&&(e.searchParams.set("utm_source","lighthouse"),e.searchParams.set("utm_medium",this._lighthouseChannel));const i=this.createElement("a");i.rel="noopener",i.target="_blank",i.textContent=n.text,i.href=e.href,t.appendChild(i)}return t}convertMarkdownCodeSnippets(e){const t=this.createElement("span");for(const n of Util.splitMarkdownCodeSpans(e))if(n.isCode){const e=this.createElement("code");e.textContent=n.text,t.appendChild(e)}else t.appendChild(this._document.createTextNode(n.text));return t}setLighthouseChannel(e){this._lighthouseChannel=e}document(){return this._document}isDevTools(){return!!this._document.querySelector(".lh-devtools")}find(e,t){const n=t.querySelector(e);if(null===n)throw new Error(`query ${e} not found`);return n}findAll(e,t){return Array.from(t.querySelectorAll(e))}}"undefined"!=typeof module&&module.exports?module.exports=DOM:self.DOM=DOM,function(){var e,t,n,i,r=document.createElement("details"),s="undefined"!=typeof HTMLDetailsElement&&r instanceof HTMLDetailsElement,o="open"in r||s,a="ontoggle"in r,l=[],d=l.forEach,c=l.slice;function h(e){(function(e,t){return(e.tagName==t?[e]:[]).concat("function"==typeof e.getElementsByTagName?c.call(e.getElementsByTagName(t)):[])})(e,"SUMMARY").forEach((function(e){var t=g(e,"DETAILS");e.setAttribute("aria-expanded",t.hasAttribute("open")),e.hasAttribute("tabindex")||e.setAttribute("tabindex","0"),e.hasAttribute("role")||e.setAttribute("role","button")}))}function p(e){return!(e.defaultPrevented||e.ctrlKey||e.metaKey||e.shiftKey||e.target.isContentEditable)}function u(e){addEventListener("click",(function(t){if(p(t)&&t.which<=1){var n=g(t.target,"SUMMARY");n&&n.parentNode&&"DETAILS"==n.parentNode.tagName&&e(n.parentNode)}}),!1),addEventListener("keydown",(function(t){if(p(t)&&(13==t.keyCode||32==t.keyCode)){var n=g(t.target,"SUMMARY");n&&n.parentNode&&"DETAILS"==n.parentNode.tagName&&(e(n.parentNode),t.preventDefault())}}),!1)}function m(e){var t=document.createEvent("Event");t.initEvent("toggle",!1,!1),e.dispatchEvent(t)}function g(e,t){if("function"==typeof e.closest)return e.closest(t);for(;e;){if(e.tagName==t)return e;e=e.parentNode}}o||(document.head.insertAdjacentHTML("afterbegin",'<style>\ndetails, summary {\n  display: block;\n}\ndetails:not([open]) > *:not(summary) {\n  display: none;\n}\nsummary::before {\n  content: "►";\n  padding-right: 0.3rem;\n  font-size: 0.6rem;\n  cursor: default;\n}\n[open] > summary::before {\n  content: "▼";\n}\n</style>'),e=document.createElement("details").constructor.prototype,t=e.setAttribute,n=e.removeAttribute,i=Object.getOwnPropertyDescriptor(e,"open"),Object.defineProperties(e,{open:{get:function(){return"DETAILS"==this.tagName?this.hasAttribute("open"):i&&i.get?i.get.call(this):void 0},set:function(e){return"DETAILS"==this.tagName?e?this.setAttribute("open",""):this.removeAttribute("open"):i&&i.set?i.set.call(this,e):void 0}},setAttribute:{value:function(e,n){var i=this,r=function(){return t.call(i,e,n)};if("open"==e&&"DETAILS"==this.tagName){var s=this.hasAttribute("open"),o=r();if(!s){var a=this.querySelector("summary");a&&a.setAttribute("aria-expanded",!0),m(this)}return o}return r()}},removeAttribute:{value:function(e){var t=this,i=function(){return n.call(t,e)};if("open"==e&&"DETAILS"==this.tagName){var r=this.hasAttribute("open"),s=i();if(r){var o=this.querySelector("summary");o&&o.setAttribute("aria-expanded",!1),m(this)}return s}return i()}}}),u((function(e){e.hasAttribute("open")?e.removeAttribute("open"):e.setAttribute("open","")})),h(document),window.MutationObserver?new MutationObserver((function(e){d.call(e,(function(e){d.call(e.addedNodes,h)}))})).observe(document.documentElement,{subtree:!0,childList:!0}):document.addEventListener("DOMNodeInserted",(function(e){h(e.target)}))),o&&!a&&(window.MutationObserver?new MutationObserver((function(e){d.call(e,(function(e){var t=e.target,n=e.attributeName;"DETAILS"==t.tagName&&"open"==n&&m(t)}))})).observe(document.documentElement,{attributes:!0,subtree:!0}):u((function(e){var t=e.getAttribute("open");setTimeout((function(){var n=e.getAttribute("open");t!=n&&m(e)}),1)})))}();const URL_PREFIXES=["http://","https://","data:"];class DetailsRenderer{constructor(e){this._dom=e,this._templateContext}setTemplateContext(e){this._templateContext=e}render(e){switch(e.type){case"filmstrip":return this._renderFilmstrip(e);case"list":return this._renderList(e);case"table":return this._renderTable(e);case"criticalrequestchain":return CriticalRequestChainRenderer.render(this._dom,this._templateContext,e,this);case"opportunity":return this._renderTable(e);case"screenshot":case"debugdata":return null;default:return this._renderUnknown(e.type,e)}}_renderBytes(e){const t=Util.formatBytesToKB(e.value,e.granularity);return this._renderText(t)}_renderMilliseconds(e){let t=Util.formatMilliseconds(e.value,e.granularity);return"duration"===e.displayUnit&&(t=Util.formatDuration(e.value)),this._renderText(t)}renderTextURL(e){const t=e;let n,i,r;try{const e=Util.parseURL(t);n="/"===e.file?e.origin:e.file,i="/"===e.file?"":`(${e.hostname})`,r=t}catch(e){n=t}const s=this._dom.createElement("div","lh-text__url");if(s.appendChild(this._renderLink({text:n,url:t})),i){const e=this._renderText(i);e.classList.add("lh-text__url-host"),s.appendChild(e)}return r&&(s.title=t,s.dataset.url=t),s}_renderLink(e){let t;try{t=new URL(e.url)}catch(e){}if(!t||!["https:","http:"].includes(t.protocol))return this._renderText(e.text);const n=this._dom.createElement("a");return n.rel="noopener",n.target="_blank",n.textContent=e.text,n.href=t.href,n}_renderText(e){const t=this._dom.createElement("div","lh-text");return t.textContent=e,t}_renderNumeric(e){const t=this._dom.createElement("div","lh-numeric");return t.textContent=e,t}_renderThumbnail(e){const t=this._dom.createElement("img","lh-thumbnail"),n=e;return t.src=n,t.title=n,t.alt="",t}_renderUnknown(e,t){console.error("Unknown details type: "+e,t);const n=this._dom.createElement("details","lh-unknown");return this._dom.createChildOf(n,"summary").textContent=`We don't know how to render audit details of type \`${e}\`. The Lighthouse version that collected this data is likely newer than the Lighthouse version of the report renderer. Expand for the raw JSON.`,this._dom.createChildOf(n,"pre").textContent=JSON.stringify(t,null,2),n}_renderTableValue(e,t){if(null==e)return null;if("object"==typeof e)switch(e.type){case"code":return this._renderCode(e.value);case"link":return this._renderLink(e);case"node":return this.renderNode(e);case"url":return this.renderTextURL(e.value);default:return this._renderUnknown(e.type,e)}switch(t.valueType){case"bytes":{const t=Number(e);return this._renderBytes({value:t,granularity:1})}case"code":{const t=String(e);return this._renderCode(t)}case"ms":{const n={value:Number(e),granularity:t.granularity,displayUnit:t.displayUnit};return this._renderMilliseconds(n)}case"numeric":{const t=String(e);return this._renderNumeric(t)}case"text":{const t=String(e);return this._renderText(t)}case"thumbnail":{const t=String(e);return this._renderThumbnail(t)}case"timespanMs":{const t=Number(e);return this._renderMilliseconds({value:t})}case"url":{const t=String(e);return URL_PREFIXES.some(e=>t.startsWith(e))?this.renderTextURL(t):this._renderCode(t)}default:return this._renderUnknown(t.valueType,e)}}_getCanonicalizedTableHeadings(e){return"opportunity"===e.type?e.headings:e.headings.map(e=>({key:e.key,label:e.text,valueType:e.itemType,displayUnit:e.displayUnit,granularity:e.granularity}))}_renderTable(e){if(!e.items.length)return this._dom.createElement("span");const t=this._dom.createElement("table","lh-table"),n=this._dom.createChildOf(t,"thead"),i=this._dom.createChildOf(n,"tr"),r=this._getCanonicalizedTableHeadings(e);for(const e of r){const t="lh-table-column--"+(e.valueType||"text"),n=this._dom.createElement("div","lh-text");n.textContent=e.label,this._dom.createChildOf(i,"th",t).appendChild(n)}const s=this._dom.createChildOf(t,"tbody");for(const t of e.items){const e=this._dom.createChildOf(s,"tr");for(const n of r){const i=t[n.key],r=this._renderTableValue(i,n);if(r){const t="lh-table-column--"+n.valueType;this._dom.createChildOf(e,"td",t).appendChild(r)}else this._dom.createChildOf(e,"td","lh-table-column--empty")}}return t}_renderList(e){const t=this._dom.createElement("div","lh-list");return e.items.forEach(e=>{const n=SnippetRenderer.render(this._dom,this._templateContext,e,this);t.appendChild(n)}),t}renderNode(e){const t=this._dom.createElement("span","lh-node");if(e.nodeLabel){const n=this._dom.createElement("div");n.textContent=e.nodeLabel,t.appendChild(n)}if(e.snippet){const n=this._dom.createElement("div");n.classList.add("lh-node__snippet"),n.textContent=e.snippet,t.appendChild(n)}return e.selector&&(t.title=e.selector),e.path&&t.setAttribute("data-path",e.path),e.selector&&t.setAttribute("data-selector",e.selector),e.snippet&&t.setAttribute("data-snippet",e.snippet),t}_renderFilmstrip(e){const t=this._dom.createElement("div","lh-filmstrip");for(const n of e.items){const e=this._dom.createChildOf(t,"div","lh-filmstrip__frame");this._dom.createChildOf(e,"img","lh-filmstrip__thumbnail",{src:n.data,alt:"Screenshot"})}return t}_renderCode(e){const t=this._dom.createElement("pre","lh-code");return t.textContent=e,t}}"undefined"!=typeof module&&module.exports?module.exports=DetailsRenderer:self.DetailsRenderer=DetailsRenderer;class CriticalRequestChainRenderer{static initTree(e){let t=0;const n=Object.keys(e);if(n.length>0){t=e[n[0]].request.startTime}return{tree:e,startTime:t,transferSize:0}}static createSegment(e,t,n,i,r,s){const o=e[t],a=Object.keys(e),l=a.indexOf(t)===a.length-1,d=!!o.children&&Object.keys(o.children).length>0,c=Array.isArray(r)?r.slice(0):[];return void 0!==s&&c.push(!s),{node:o,isLastChild:l,hasChildren:d,startTime:n,transferSize:i+o.request.transferSize,treeMarkers:c}}static createChainNode(e,t,n,i){const r=e.cloneTemplate("#tmpl-lh-crc__chains",t);e.find(".crc-node",r).setAttribute("title",n.node.request.url);const s=e.find(".crc-node__tree-marker",r);n.treeMarkers.forEach(t=>{t?(s.appendChild(e.createElement("span","tree-marker vert")),s.appendChild(e.createElement("span","tree-marker"))):(s.appendChild(e.createElement("span","tree-marker")),s.appendChild(e.createElement("span","tree-marker")))}),n.isLastChild?(s.appendChild(e.createElement("span","tree-marker up-right")),s.appendChild(e.createElement("span","tree-marker right"))):(s.appendChild(e.createElement("span","tree-marker vert-right")),s.appendChild(e.createElement("span","tree-marker right"))),n.hasChildren?s.appendChild(e.createElement("span","tree-marker horiz-down")):s.appendChild(e.createElement("span","tree-marker right"));const o=n.node.request.url,a=i.renderTextURL(o),l=e.find(".crc-node__tree-value",r);if(l.appendChild(a),!n.hasChildren){const{startTime:t,endTime:i,transferSize:r}=n.node.request,s=e.createElement("span","crc-node__chain-duration");s.textContent=" - "+Util.formatMilliseconds(1e3*(i-t))+", ";const o=e.createElement("span","crc-node__chain-duration");o.textContent=Util.formatBytesToKB(r,.01),l.appendChild(s),l.appendChild(o)}return r}static buildTree(e,t,n,i,r,s){if(i.appendChild(CRCRenderer.createChainNode(e,t,n,s)),n.node.children)for(const o of Object.keys(n.node.children)){const a=CRCRenderer.createSegment(n.node.children,o,n.startTime,n.transferSize,n.treeMarkers,n.isLastChild);CRCRenderer.buildTree(e,t,a,i,r,s)}}static render(e,t,n,i){const r=e.cloneTemplate("#tmpl-lh-crc",t),s=e.find(".lh-crc",r);e.find(".crc-initial-nav",r).textContent=Util.UIStrings.crcInitialNavigation,e.find(".lh-crc__longest_duration_label",r).textContent=Util.UIStrings.crcLongestDurationLabel,e.find(".lh-crc__longest_duration",r).textContent=Util.formatMilliseconds(n.longestChain.duration);const o=CRCRenderer.initTree(n.chains);for(const t of Object.keys(o.tree)){const a=CRCRenderer.createSegment(o.tree,t,o.startTime,o.transferSize);CRCRenderer.buildTree(e,r,a,s,n,i)}return e.find(".lh-crc-container",r)}}const CRCRenderer=CriticalRequestChainRenderer;"undefined"!=typeof module&&module.exports?module.exports=CriticalRequestChainRenderer:self.CriticalRequestChainRenderer=CriticalRequestChainRenderer;const LineVisibility={ALWAYS:0,WHEN_COLLAPSED:1,WHEN_EXPANDED:2},LineContentType={CONTENT_NORMAL:0,CONTENT_HIGHLIGHTED:1,PLACEHOLDER:2,MESSAGE:3},classNamesByContentType={[LineContentType.CONTENT_NORMAL]:["lh-snippet__line--content"],[LineContentType.CONTENT_HIGHLIGHTED]:["lh-snippet__line--content","lh-snippet__line--content-highlighted"],[LineContentType.PLACEHOLDER]:["lh-snippet__line--placeholder"],[LineContentType.MESSAGE]:["lh-snippet__line--message"]};function getLineAndPreviousLine(e,t){return{line:e.find(e=>e.lineNumber===t),previousLine:e.find(e=>e.lineNumber===t-1)}}function getMessagesForLineNumber(e,t){return e.filter(e=>e.lineNumber===t)}function getLinesWhenCollapsed(e){return Util.filterRelevantLines(e.lines,e.lineMessages,2)}class SnippetRenderer{static renderHeader(e,t,n,i,r){const s=getLinesWhenCollapsed(n).length<n.lines.length,o=e.cloneTemplate("#tmpl-lh-snippet__header",t);e.find(".lh-snippet__title",o).textContent=n.title;const{snippetCollapseButtonLabel:a,snippetExpandButtonLabel:l}=Util.UIStrings;e.find(".lh-snippet__btn-label-collapse",o).textContent=a,e.find(".lh-snippet__btn-label-expand",o).textContent=l;const d=e.find(".lh-snippet__toggle-expand",o);if(s?d.addEventListener("click",()=>r()):d.remove(),n.node&&e.isDevTools()){e.find(".lh-snippet__node",o).appendChild(i.renderNode(n.node))}return o}static renderSnippetLine(e,t,{content:n,lineNumber:i,truncated:r,contentType:s,visibility:o}){const a=e.cloneTemplate("#tmpl-lh-snippet__line",t),l=e.find(".lh-snippet__line",a),{classList:d}=l;classNamesByContentType[s].forEach(e=>d.add(e)),o===LineVisibility.WHEN_COLLAPSED?d.add("lh-snippet__show-if-collapsed"):o===LineVisibility.WHEN_EXPANDED&&d.add("lh-snippet__show-if-expanded");const c=n+(r?"…":""),h=e.find(".lh-snippet__line code",l);return s===LineContentType.MESSAGE?h.appendChild(e.convertMarkdownLinkSnippets(c)):h.textContent=c,e.find(".lh-snippet__line-number",l).textContent=i.toString(),l}static renderMessage(e,t,n){return SnippetRenderer.renderSnippetLine(e,t,{lineNumber:" ",content:n.message,contentType:LineContentType.MESSAGE})}static renderOmittedLinesPlaceholder(e,t,n){return SnippetRenderer.renderSnippetLine(e,t,{lineNumber:"…",content:"",visibility:n,contentType:LineContentType.PLACEHOLDER})}static renderSnippetContent(e,t,n){const i=e.cloneTemplate("#tmpl-lh-snippet__content",t),r=e.find(".lh-snippet__snippet-inner",i);return n.generalMessages.forEach(n=>r.append(SnippetRenderer.renderMessage(e,t,n))),r.append(SnippetRenderer.renderSnippetLines(e,t,n)),i}static renderSnippetLines(e,t,n){const{lineMessages:i,generalMessages:r,lineCount:s,lines:o}=n,a=getLinesWhenCollapsed(n),l=r.length>0&&0===i.length,d=e.createFragment();let c=!1;for(let n=1;n<=s;n++){const{line:r,previousLine:s}=getLineAndPreviousLine(o,n),{line:h,previousLine:p}=getLineAndPreviousLine(a,n),u=!!h;!!p&&!u&&(c=!0),u&&c&&(d.append(SnippetRenderer.renderOmittedLinesPlaceholder(e,t,LineVisibility.WHEN_COLLAPSED)),c=!1);const m=!r&&1===n;if(!r&&!!s||m){const i=!a.some(e=>e.lineNumber>n)||1===n;d.append(SnippetRenderer.renderOmittedLinesPlaceholder(e,t,i?LineVisibility.WHEN_EXPANDED:LineVisibility.ALWAYS)),c=!1}if(!r)continue;const g=getMessagesForLineNumber(i,n),f=g.length>0||l,_=Object.assign({},r,{contentType:f?LineContentType.CONTENT_HIGHLIGHTED:LineContentType.CONTENT_NORMAL,visibility:h?LineVisibility.ALWAYS:LineVisibility.WHEN_EXPANDED});d.append(SnippetRenderer.renderSnippetLine(e,t,_)),g.forEach(n=>{d.append(SnippetRenderer.renderMessage(e,t,n))})}return d}static render(e,t,n,i){const r=e.cloneTemplate("#tmpl-lh-snippet",t),s=e.find(".lh-snippet",r),o=SnippetRenderer.renderHeader(e,r,n,i,()=>s.classList.toggle("lh-snippet--expanded")),a=SnippetRenderer.renderSnippetContent(e,r,n);return s.append(o,a),s}}function getFilenamePrefix(e){const t=new URL(e.finalUrl).hostname,n=e.fetchTime&&new Date(e.fetchTime)||new Date,i=n.toLocaleTimeString("en-US",{hour12:!1}),r=n.toLocaleDateString("en-US",{year:"numeric",month:"2-digit",day:"2-digit"}).split("/");r.unshift(r.pop());return`${t}_${r.join("-")}_${i}`.replace(/[/?<>\\:*|"]/g,"-")}"undefined"!=typeof module&&module.exports?module.exports=SnippetRenderer:self.SnippetRenderer=SnippetRenderer,"undefined"!=typeof module&&module.exports&&(module.exports={getFilenamePrefix:getFilenamePrefix});class Logger{constructor(e){this.el=e,this._id=void 0}log(e,t=!0){this._id&&clearTimeout(this._id),this.el.textContent=e,this.el.classList.add("show"),t&&(this._id=setTimeout(e=>{this.el.classList.remove("show")},7e3))}warn(e){this.log("Warning: "+e)}error(e){this.log(e),setTimeout(t=>{throw new Error(e)},0)}hide(){this._id&&clearTimeout(this._id),this.el.classList.remove("show")}}function getTableRows(e){return Array.from(e.tBodies[0].rows)}"undefined"!=typeof module&&module.exports&&(module.exports=Logger);class ReportUIFeatures{constructor(e){this.json,this._dom=e,this._document=this._dom.document(),this._templateContext=this._dom.document(),this._dropDown=new DropDown(this._dom),this._copyAttempt=!1,this.topbarEl,this.scoreScaleEl,this.stickyHeaderEl,this.highlightEl,this.onMediaQueryChange=this.onMediaQueryChange.bind(this),this.onCopy=this.onCopy.bind(this),this.onDropDownMenuClick=this.onDropDownMenuClick.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.collapseAllDetails=this.collapseAllDetails.bind(this),this.expandAllDetails=this.expandAllDetails.bind(this),this._toggleDarkTheme=this._toggleDarkTheme.bind(this),this._updateStickyHeaderOnScroll=this._updateStickyHeaderOnScroll.bind(this)}initFeatures(e){this.json=e,this._setupMediaQueryListeners(),this._dropDown.setup(this.onDropDownMenuClick),this._setupThirdPartyFilter(),this._setUpCollapseDetailsAfterPrinting(),this._resetUIState(),this._document.addEventListener("keyup",this.onKeyUp),this._document.addEventListener("copy",this.onCopy);this._dom.find(".lh-topbar__logo",this._document).addEventListener("click",()=>this._toggleDarkTheme());let t=!1;!this._dom.isDevTools()&&window.matchMedia("(prefers-color-scheme: dark)").matches&&(t=!0);const n=Object.values(e.categories).every(e=>1===e.score),i=Object.keys(e.categories).filter(e=>!Util.isPluginCategory(e)).length>=5;if(n&&i&&(t=!0,this._enableFireworks()),t&&this._toggleDarkTheme(!0),Object.keys(this.json.categories).length>=2){this._setupStickyHeaderElements();const e=this._dom.find(".lh-container",this._document);if(this._getScrollParent(e).addEventListener("scroll",this._updateStickyHeaderOnScroll),this._dom.isDevTools()){new window.ResizeObserver(this._updateStickyHeaderOnScroll).observe(e)}else window.addEventListener("resize",this._updateStickyHeaderOnScroll)}if(e.categories.performance&&e.categories.performance.auditRefs.some(t=>Boolean("metrics"===t.group&&e.audits[t.id].errorMessage))){this._dom.find(".lh-metrics-toggle__input",this._document).checked=!0}}setTemplateContext(e){this._templateContext=e}_getScrollParent(e){const{overflowY:t}=window.getComputedStyle(e);return"visible"!==t&&"hidden"!==t?e:e.parentElement?this._getScrollParent(e.parentElement):document}_enableFireworks(){const e=this._dom.find(".lh-scores-container",this._document);e.classList.add("score100"),e.addEventListener("click",t=>{e.classList.toggle("fireworks-paused")})}_fireEventOn(e,t=this._document,n){const i=new CustomEvent(e,n?{detail:n}:void 0);t.dispatchEvent(i)}_setupMediaQueryListeners(){const e=self.matchMedia("(max-width: 500px)");e.addListener(this.onMediaQueryChange),this.onMediaQueryChange(e)}onMediaQueryChange(e){this._dom.find(".lh-root",this._document).classList.toggle("lh-narrow",e.matches)}_setupThirdPartyFilter(){const e=["uses-rel-preconnect"];Array.from(this._document.querySelectorAll(".lh-table")).filter(e=>e.querySelector("td.lh-table-column--url")).filter(t=>{const n=t.closest(".lh-audit");if(!n)throw new Error(".lh-table not within audit");return!e.includes(n.id)}).forEach((e,t)=>{const n=this._getUrlItems(e),i=this._getThirdPartyRows(e,n,this.json.finalUrl),r=this._dom.cloneTemplate("#tmpl-lh-3p-filter",this._templateContext),s=this._dom.find("input",r),o="lh-3p-filter-label--"+t;s.id=o,s.addEventListener("change",t=>{if(t.target instanceof HTMLInputElement&&!t.target.checked)for(const e of i.values())e.remove();else for(const[t,n]of i.entries()){const i=getTableRows(e);e.tBodies[0].insertBefore(n,i[t])}}),this._dom.find("label",r).setAttribute("for",o),this._dom.find(".lh-3p-filter-count",r).textContent=""+i.size,this._dom.find(".lh-3p-ui-string",r).textContent=Util.UIStrings.thirdPartyResourcesLabel,i.size!==n.length&&i.size||(s.disabled=!0,s.checked=i.size===n.length),e.parentNode&&e.parentNode.insertBefore(r,e)})}_getThirdPartyRows(e,t,n){const i=Util.getRootDomain(n),r=new Map;for(const n of t){const t=n.dataset.url;if(!t)continue;if(!(Util.getRootDomain(t)!==i))continue;const s=n.closest("tr");if(s){const t=getTableRows(e).indexOf(s);r.set(t,s)}}return r}_getUrlItems(e){return this._dom.findAll(".lh-text__url",e)}_setupStickyHeaderElements(){this.topbarEl=this._dom.find(".lh-topbar",this._document),this.scoreScaleEl=this._dom.find(".lh-scorescale",this._document),this.stickyHeaderEl=this._dom.find(".lh-sticky-header",this._document),this.highlightEl=this._dom.createChildOf(this.stickyHeaderEl,"div","lh-highlighter")}onCopy(e){this._copyAttempt&&e.clipboardData&&(e.preventDefault(),e.clipboardData.setData("text/plain",JSON.stringify(this.json,null,2)),this._fireEventOn("lh-log",this._document,{cmd:"log",msg:"Report JSON copied to clipboard"})),this._copyAttempt=!1}onCopyButtonClick(){this._fireEventOn("lh-analytics",this._document,{cmd:"send",fields:{hitType:"event",eventCategory:"report",eventAction:"copy"}});try{this._document.queryCommandSupported("copy")&&(this._copyAttempt=!0,this._document.execCommand("copy")||(this._copyAttempt=!1,this._fireEventOn("lh-log",this._document,{cmd:"warn",msg:"Your browser does not support copy to clipboard."})))}catch(e){this._copyAttempt=!1,this._fireEventOn("lh-log",this._document,{cmd:"log",msg:e.message})}}_resetUIState(){this._dropDown.close(),this._dom.resetTemplates()}onDropDownMenuClick(e){e.preventDefault();const t=e.target;if(t&&t.hasAttribute("data-action")){switch(t.getAttribute("data-action")){case"copy":this.onCopyButtonClick();break;case"print-summary":this.collapseAllDetails(),this._print();break;case"print-expanded":this.expandAllDetails(),this._print();break;case"save-json":{const e=JSON.stringify(this.json,null,2);this._saveFile(new Blob([e],{type:"application/json"}));break}case"save-html":{const t=this.getReportHtml();try{this._saveFile(new Blob([t],{type:"text/html"}))}catch(e){this._fireEventOn("lh-log",this._document,{cmd:"error",msg:"Could not export as HTML. "+e.message})}break}case"open-viewer":{const e="/lighthouse/viewer/";ReportUIFeatures.openTabAndSendJsonReport(this.json,e);break}case"save-gist":this.saveAsGist();break;case"toggle-dark":this._toggleDarkTheme()}this._dropDown.close()}}_print(){self.print()}onKeyUp(e){(e.ctrlKey||e.metaKey)&&80===e.keyCode&&this._dropDown.close()}static openTabAndSendJsonReport(e,t){const n="https://googlechrome.github.io",i=e;window.addEventListener("message",(function e(t){t.origin===n&&a&&t.data.opened&&(a.postMessage({lhresults:i},n),window.removeEventListener("message",e))}));const r=i.generatedTime,s=i.fetchTime||r,o=`${i.lighthouseVersion}-${i.requestedUrl}-${s}`,a=window.open(`${n}${t}`,o)}expandAllDetails(){this._dom.findAll(".lh-categories details",this._document).map(e=>e.open=!0)}collapseAllDetails(){this._dom.findAll(".lh-categories details",this._document).map(e=>e.open=!1)}_setUpCollapseDetailsAfterPrinting(){if("onbeforeprint"in self)self.addEventListener("afterprint",this.collapseAllDetails);else{self.matchMedia("print").addListener(e=>{e.matches?this.expandAllDetails():this.collapseAllDetails()})}}getReportHtml(){return this._resetUIState(),this._document.documentElement.outerHTML}saveAsGist(){throw new Error("Cannot save as gist from base report")}_saveFile(e){const t=getFilenamePrefix({finalUrl:this.json.finalUrl,fetchTime:this.json.fetchTime}),n=e.type.match("json")?".json":".html",i=URL.createObjectURL(e),r=this._dom.createElement("a");r.download=`${t}${n}`,r.href=i,this._document.body.appendChild(r),r.click(),this._document.body.removeChild(r),setTimeout(e=>URL.revokeObjectURL(i),500)}_toggleDarkTheme(e){const t=this._dom.find(".lh-vars",this._document);void 0===e?t.classList.toggle("dark"):t.classList.toggle("dark",e)}_updateStickyHeaderOnScroll(){const e=this.topbarEl.getBoundingClientRect().bottom>=this.scoreScaleEl.getBoundingClientRect().top,t=Array.from(this._document.querySelectorAll(".lh-category")).filter(e=>e.getBoundingClientRect().top-window.innerHeight/2<0),n=t.length>0?t.length-1:0,i=this.stickyHeaderEl.querySelectorAll(".lh-gauge__wrapper"),r=i[n],s=i[0].getBoundingClientRect().left,o=r.getBoundingClientRect().left-s;this.highlightEl.style.transform=`translate(${o}px)`,this.stickyHeaderEl.classList.toggle("lh-sticky-header--visible",e)}}class DropDown{constructor(e){this._dom=e,this._toggleEl,this._menuEl,this.onDocumentKeyDown=this.onDocumentKeyDown.bind(this),this.onToggleClick=this.onToggleClick.bind(this),this.onToggleKeydown=this.onToggleKeydown.bind(this),this.onMenuKeydown=this.onMenuKeydown.bind(this),this._getNextMenuItem=this._getNextMenuItem.bind(this),this._getNextSelectableNode=this._getNextSelectableNode.bind(this),this._getPreviousMenuItem=this._getPreviousMenuItem.bind(this)}setup(e){this._toggleEl=this._dom.find(".lh-tools__button",this._dom.document()),this._toggleEl.addEventListener("click",this.onToggleClick),this._toggleEl.addEventListener("keydown",this.onToggleKeydown),this._menuEl=this._dom.find(".lh-tools__dropdown",this._dom.document()),this._menuEl.addEventListener("keydown",this.onMenuKeydown),this._menuEl.addEventListener("click",e)}close(){this._toggleEl.classList.remove("active"),this._toggleEl.setAttribute("aria-expanded","false"),this._menuEl.contains(this._dom.document().activeElement)&&this._toggleEl.focus(),this._dom.document().removeEventListener("keydown",this.onDocumentKeyDown)}open(e){this._toggleEl.classList.contains("active")?e.focus():this._menuEl.addEventListener("transitionend",()=>{e.focus()},{once:!0}),this._toggleEl.classList.add("active"),this._toggleEl.setAttribute("aria-expanded","true"),this._dom.document().addEventListener("keydown",this.onDocumentKeyDown)}onToggleClick(e){e.preventDefault(),e.stopImmediatePropagation(),this._toggleEl.classList.contains("active")?this.close():this.open(this._getNextMenuItem())}onToggleKeydown(e){switch(e.code){case"ArrowUp":e.preventDefault(),this.open(this._getPreviousMenuItem());break;case"ArrowDown":case"Enter":case" ":e.preventDefault(),this.open(this._getNextMenuItem())}}onMenuKeydown(e){const t=e.target;switch(e.code){case"ArrowUp":e.preventDefault(),this._getPreviousMenuItem(t).focus();break;case"ArrowDown":e.preventDefault(),this._getNextMenuItem(t).focus();break;case"Home":e.preventDefault(),this._getNextMenuItem().focus();break;case"End":e.preventDefault(),this._getPreviousMenuItem().focus()}}onDocumentKeyDown(e){27===e.keyCode&&this.close()}_getNextSelectableNode(e,t){const n=e.filter(e=>e instanceof HTMLElement&&(!e.hasAttribute("disabled")&&"none"!==window.getComputedStyle(e).display));let i=t?n.indexOf(t)+1:0;return i>=n.length&&(i=0),n[i]}_getNextMenuItem(e){const t=Array.from(this._menuEl.childNodes);return this._getNextSelectableNode(t,e)}_getPreviousMenuItem(e){const t=Array.from(this._menuEl.childNodes).reverse();return this._getNextSelectableNode(t,e)}}"undefined"!=typeof module&&module.exports?module.exports=ReportUIFeatures:self.ReportUIFeatures=ReportUIFeatures;class CategoryRenderer{constructor(e,t){this.dom=e,this.detailsRenderer=t,this.templateContext=this.dom.document(),this.detailsRenderer.setTemplateContext(this.templateContext)}get _clumpTitles(){return{warning:Util.UIStrings.warningAuditsGroupTitle,manual:Util.UIStrings.manualAuditsGroupTitle,passed:Util.UIStrings.passedAuditsGroupTitle,notApplicable:Util.UIStrings.notApplicableAuditsGroupTitle}}renderAudit(e){const t=this.dom.cloneTemplate("#tmpl-lh-audit",this.templateContext);return this.populateAuditValues(e,t)}populateAuditValues(e,t){const n=this.dom.find(".lh-audit",t);n.id=e.result.id;const i=e.result.scoreDisplayMode;e.result.displayValue&&(this.dom.find(".lh-audit__display-text",n).textContent=e.result.displayValue);const r=this.dom.find(".lh-audit__title",n);r.appendChild(this.dom.convertMarkdownCodeSnippets(e.result.title)),this.dom.find(".lh-audit__description",n).appendChild(this.dom.convertMarkdownLinkSnippets(e.result.description)),e.stackPacks&&e.stackPacks.forEach(e=>{const t=this.dom.createElement("div");t.classList.add("lh-audit__stackpack");const i=this.dom.createElement("img");i.classList.add("lh-audit__stackpack__img"),i.src=e.iconDataURL,i.alt=e.title,t.appendChild(i),t.appendChild(this.dom.convertMarkdownLinkSnippets(e.description)),this.dom.find(".lh-audit__stackpacks",n).appendChild(t)});const s=this.dom.find("details",n);if(e.result.details){const t=this.detailsRenderer.render(e.result.details);t&&(t.classList.add("lh-details"),s.appendChild(t))}if(this.dom.find(".lh-chevron-container",n).appendChild(this._createChevron()),this._setRatingClass(n,e.result.score,i),"error"===e.result.scoreDisplayMode){n.classList.add("lh-audit--error");const t=this.dom.find(".lh-audit__display-text",n);t.textContent=Util.UIStrings.errorLabel,t.classList.add("tooltip-boundary");this.dom.createChildOf(t,"div","tooltip tooltip--error").textContent=e.result.errorMessage||Util.UIStrings.errorMissingAuditInfo}else if(e.result.explanation){this.dom.createChildOf(r,"div","lh-audit-explanation").textContent=e.result.explanation}const o=e.result.warnings;if(!o||0===o.length)return n;const a=this.dom.createChildOf(r,"div","lh-warnings");if(this.dom.createChildOf(a,"span").textContent=Util.UIStrings.warningHeader,1===o.length)a.appendChild(this.dom.document().createTextNode(o.join("")));else{const e=this.dom.createChildOf(a,"ul");for(const t of o){this.dom.createChildOf(e,"li").textContent=t}}return n}_createChevron(){const e=this.dom.cloneTemplate("#tmpl-lh-chevron",this.templateContext);return this.dom.find(".lh-chevron",e)}_setRatingClass(e,t,n){const i=Util.calculateRating(t,n);return e.classList.add("lh-audit--"+n.toLowerCase()),"informative"!==n&&e.classList.add("lh-audit--"+i),e}renderCategoryHeader(e,t){const n=this.dom.cloneTemplate("#tmpl-lh-category-header",this.templateContext),i=this.dom.find(".lh-score__gauge",n),r=this.renderScoreGauge(e,t);if(i.appendChild(r),e.description){const t=this.dom.convertMarkdownLinkSnippets(e.description);this.dom.find(".lh-category-header__description",n).appendChild(t)}return n.firstElementChild}renderAuditGroup(e){const t=this.dom.createElement("div","lh-audit-group"),n=this.dom.createElement("div","lh-audit-group__header");if(this.dom.createChildOf(n,"span","lh-audit-group__title").textContent=e.title,e.description){const t=this.dom.convertMarkdownLinkSnippets(e.description);t.classList.add("lh-audit-group__description"),n.appendChild(t)}return t.appendChild(n),t}_renderGroupedAudits(e,t){const n=new Map;n.set("NotAGroup",[]);for(const t of e){const e=t.group||"NotAGroup",i=n.get(e)||[];i.push(t),n.set(e,i)}const i=[];for(const[e,r]of n){if("NotAGroup"===e){for(const e of r)i.push(this.renderAudit(e));continue}const n=t[e],s=this.renderAuditGroup(n);for(const e of r)s.appendChild(this.renderAudit(e));s.classList.add("lh-audit-group--"+e),i.push(s)}return i}renderUnexpandableClump(e,t){const n=this.dom.createElement("div");return this._renderGroupedAudits(e,t).forEach(e=>n.appendChild(e)),n}renderClump(e,{auditRefs:t,description:n}){const i=this.dom.cloneTemplate("#tmpl-lh-clump",this.templateContext),r=this.dom.find(".lh-clump",i);"warning"===e&&r.setAttribute("open","");this.dom.find(".lh-audit-group__summary",r).appendChild(this._createChevron()).title=Util.UIStrings.auditGroupExpandTooltip;const s=this.dom.find(".lh-audit-group__header",r),o=this._clumpTitles[e];if(this.dom.find(".lh-audit-group__title",s).textContent=o,n){const e=this.dom.convertMarkdownLinkSnippets(n);e.classList.add("lh-audit-group__description"),s.appendChild(e)}this.dom.find(".lh-audit-group__itemcount",r).textContent=`(${t.length})`;const a=t.map(this.renderAudit.bind(this));return r.append(...a),r.classList.add("lh-clump--"+e.toLowerCase()),r}setTemplateContext(e){this.templateContext=e,this.detailsRenderer.setTemplateContext(e)}renderScoreGauge(e,t){const n=this.dom.cloneTemplate("#tmpl-lh-gauge",this.templateContext),i=this.dom.find(".lh-gauge__wrapper",n);i.href="#"+e.id,i.classList.add("lh-gauge__wrapper--"+Util.calculateRating(e.score)),Util.isPluginCategory(e.id)&&i.classList.add("lh-gauge__wrapper--plugin");const r=Number(e.score),s=this.dom.find(".lh-gauge",n).querySelector(".lh-gauge-arc");s&&(s.style.strokeDasharray=352*r+" 352");const o=Math.round(100*r),a=this.dom.find(".lh-gauge__percentage",n);return a.textContent=o.toString(),null===e.score&&(a.textContent="?",a.title=Util.UIStrings.errorLabel),this.dom.find(".lh-gauge__label",n).textContent=e.title,n}_auditHasWarning(e){return Boolean(e.result.warnings&&e.result.warnings.length)}_getClumpIdForAuditRef(e){const t=e.result.scoreDisplayMode;return"manual"===t||"notApplicable"===t?t:Util.showAsPassed(e.result)?this._auditHasWarning(e)?"warning":"passed":"failed"}render(e,t={}){const n=this.dom.createElement("div","lh-category");this.createPermalinkSpan(n,e.id),n.appendChild(this.renderCategoryHeader(e,t));const i=new Map;i.set("failed",[]),i.set("warning",[]),i.set("manual",[]),i.set("passed",[]),i.set("notApplicable",[]);for(const t of e.auditRefs){const e=this._getClumpIdForAuditRef(t),n=i.get(e);n.push(t),i.set(e,n)}for(const[r,s]of i){if(0===s.length)continue;if("failed"===r){const e=this.renderUnexpandableClump(s,t);e.classList.add("lh-clump--failed"),n.appendChild(e);continue}const i="manual"===r?e.manualDescription:void 0,o=this.renderClump(r,{auditRefs:s,description:i});n.appendChild(o)}return n}createPermalinkSpan(e,t){this.dom.createChildOf(e,"span","lh-permalink").id=t}}"undefined"!=typeof module&&module.exports?module.exports=CategoryRenderer:self.CategoryRenderer=CategoryRenderer;class PerformanceCategoryRenderer extends CategoryRenderer{_renderMetric(e){const t=this.dom.cloneTemplate("#tmpl-lh-metric",this.templateContext),n=this.dom.find(".lh-metric",t);n.id=e.result.id;const i=Util.calculateRating(e.result.score,e.result.scoreDisplayMode);n.classList.add("lh-metric--"+i);this.dom.find(".lh-metric__title",t).textContent=e.result.title;const r=this.dom.find(".lh-metric__value",t);r.textContent=e.result.displayValue||"";const s=this.dom.find(".lh-metric__description",t);if(s.appendChild(this.dom.convertMarkdownLinkSnippets(e.result.description)),"error"===e.result.scoreDisplayMode){s.textContent="",r.textContent="Error!";this.dom.createChildOf(s,"span").textContent=e.result.errorMessage||"Report error: no metric information"}return n}_renderOpportunity(e,t){const n=this.dom.cloneTemplate("#tmpl-lh-opportunity",this.templateContext),i=this.populateAuditValues(e,n);if(i.id=e.result.id,!e.result.details||"error"===e.result.scoreDisplayMode)return i;const r=e.result.details;if("opportunity"!==r.type)return i;const s=this.dom.find(".lh-audit__display-text",i),o=r.overallSavingsMs/t*100+"%";if(this.dom.find(".lh-sparkline__bar",i).style.width=o,s.textContent=Util.formatSeconds(r.overallSavingsMs,.01),e.result.displayValue){const t=e.result.displayValue;this.dom.find(".lh-load-opportunity__sparkline",i).title=t,s.title=t}return i}_getWastedMs(e){if(e.result.details&&"opportunity"===e.result.details.type){const t=e.result.details;if("number"!=typeof t.overallSavingsMs)throw new Error("non-opportunity details passed to _getWastedMs");return t.overallSavingsMs}return Number.MIN_VALUE}render(e,t,n){const i=this.dom.createElement("div","lh-category");if("PSI"===n){const n=this.dom.createElement("div","lh-score__gauge");n.appendChild(this.renderScoreGauge(e,t)),i.appendChild(n)}else this.createPermalinkSpan(i,e.id),i.appendChild(this.renderCategoryHeader(e,t));const r=this.renderAuditGroup(t.metrics),s=this.dom.cloneTemplate("#tmpl-lh-metrics-toggle",this.templateContext),o=this.dom.find(".lh-metrics-toggle",s);r.append(...o.childNodes);const a=e.auditRefs.filter(e=>"metrics"===e.group),l=a.filter(e=>e.weight>=3),d=a.filter(e=>e.weight<3),c=this.dom.createChildOf(r,"div","lh-columns"),h=this.dom.createChildOf(c,"div","lh-column"),p=this.dom.createChildOf(c,"div","lh-column");if(l.forEach(e=>{h.appendChild(this._renderMetric(e))}),d.forEach(e=>{p.appendChild(this._renderMetric(e))}),"PSI"!==n){const e=this.dom.createChildOf(r,"div","lh-metrics__disclaimer"),t=this.dom.convertMarkdownLinkSnippets(Util.UIStrings.varianceDisclaimer);e.appendChild(t)}r.classList.add("lh-audit-group--metrics"),i.appendChild(r);const u=this.dom.createChildOf(i,"div","lh-filmstrip-container"),m=e.auditRefs.find(e=>"screenshot-thumbnails"===e.id),g=m&&m.result;if(g&&g.details){u.id=g.id;const e=this.detailsRenderer.render(g.details);e&&u.appendChild(e)}const f=e.auditRefs.find(e=>"performance-budget"===e.id);if(f&&f.result.details){const e=this.detailsRenderer.render(f.result.details);if(e){e.id=f.id,e.classList.add("lh-audit");const n=this.renderAuditGroup(t.budgets);n.appendChild(e),n.classList.add("lh-audit-group--budgets"),i.appendChild(n)}}const _=e.auditRefs.filter(e=>"load-opportunities"===e.group&&!Util.showAsPassed(e.result)).sort((e,t)=>this._getWastedMs(t)-this._getWastedMs(e));if(_.length){const e=2e3,n=_.map(e=>this._getWastedMs(e)),r=Math.max(...n),s=Math.max(1e3*Math.ceil(r/1e3),e),o=this.renderAuditGroup(t["load-opportunities"]),a=this.dom.cloneTemplate("#tmpl-lh-opportunity-header",this.templateContext);this.dom.find(".lh-load-opportunity__col--one",a).textContent=Util.UIStrings.opportunityResourceColumnLabel,this.dom.find(".lh-load-opportunity__col--two",a).textContent=Util.UIStrings.opportunitySavingsColumnLabel;const l=this.dom.find(".lh-load-opportunity__header",a);o.appendChild(l),_.forEach(e=>o.appendChild(this._renderOpportunity(e,s))),o.classList.add("lh-audit-group--load-opportunities"),i.appendChild(o)}const C=e.auditRefs.filter(e=>"diagnostics"===e.group&&!Util.showAsPassed(e.result)).sort((e,t)=>("informative"===e.result.scoreDisplayMode?100:Number(e.result.score))-("informative"===t.result.scoreDisplayMode?100:Number(t.result.score)));if(C.length){const e=this.renderAuditGroup(t.diagnostics);C.forEach(t=>e.appendChild(this.renderAudit(t))),e.classList.add("lh-audit-group--diagnostics"),i.appendChild(e)}const y=e.auditRefs.filter(e=>("load-opportunities"===e.group||"diagnostics"===e.group)&&Util.showAsPassed(e.result));if(!y.length)return i;const b={auditRefs:y,groupDefinitions:t},v=this.renderClump("passed",b);return i.appendChild(v),i}}"undefined"!=typeof module&&module.exports?module.exports=PerformanceCategoryRenderer:self.PerformanceCategoryRenderer=PerformanceCategoryRenderer;const getUniqueSuffix=(()=>{let e=0;return function(){return e++}})();class PwaCategoryRenderer extends CategoryRenderer{render(e,t={}){const n=this.dom.createElement("div","lh-category");this.createPermalinkSpan(n,e.id),n.appendChild(this.renderCategoryHeader(e,t));const i=e.auditRefs,r=i.filter(e=>"manual"!==e.result.scoreDisplayMode),s=this._renderAudits(r,t);n.appendChild(s);const o=i.filter(e=>"manual"===e.result.scoreDisplayMode),a=this.renderClump("manual",{auditRefs:o,description:e.manualDescription});return n.appendChild(a),n}renderScoreGauge(e,t){if(null===e.score)return super.renderScoreGauge(e,t);const n=this.dom.cloneTemplate("#tmpl-lh-gauge--pwa",this.templateContext),i=this.dom.find(".lh-gauge--pwa__wrapper",n);i.href="#"+e.id;const r=n.querySelector("svg");if(!r)throw new Error("no SVG element found in PWA score gauge template");PwaCategoryRenderer._makeSvgReferencesUnique(r);const s=this._getGroupIds(e.auditRefs),o=this._getPassingGroupIds(e.auditRefs);if(o.size===s.size)i.classList.add("lh-badged--all");else for(const e of o)i.classList.add("lh-badged--"+e);return this.dom.find(".lh-gauge__label",n).textContent=e.title,i.title=this._getGaugeTooltip(e.auditRefs,t),n}_getGroupIds(e){const t=e.map(e=>e.group).filter(e=>!!e);return new Set(t)}_getPassingGroupIds(e){const t=this._getGroupIds(e);for(const n of e)!Util.showAsPassed(n.result)&&n.group&&t.delete(n.group);return t}_getGaugeTooltip(e,t){const n=this._getGroupIds(e),i=[];for(const r of n){const n=e.filter(e=>e.group===r),s=n.length,o=n.filter(e=>Util.showAsPassed(e.result)).length,a=t[r].title;i.push(`${a}: ${o}/${s}`)}return i.join(", ")}_renderAudits(e,t){const n=this.renderUnexpandableClump(e,t),i=this._getPassingGroupIds(e);for(const e of i){this.dom.find(".lh-audit-group--"+e,n).classList.add("lh-badged")}return n}static _makeSvgReferencesUnique(e){const t=e.querySelector("defs");if(!t)return;const n=getUniqueSuffix(),i=t.querySelectorAll("[id]");for(const t of i){const i=t.id,r=`${i}-${n}`;t.id=r;const s=e.querySelectorAll(`use[href="#${i}"]`);for(const e of s)e.setAttribute("href","#"+r);const o=e.querySelectorAll(`[fill="url(#${i})"]`);for(const e of o)e.setAttribute("fill",`url(#${r})`)}}}"undefined"!=typeof module&&module.exports?module.exports=PwaCategoryRenderer:self.PwaCategoryRenderer=PwaCategoryRenderer;class ReportRenderer{constructor(e){this._dom=e,this._templateContext=this._dom.document()}renderReport(e,t){const n=JSON.parse(JSON.stringify(Util.UIStrings));this._dom.setLighthouseChannel(e.configSettings.channel||"unknown");const i=Util.prepareReportResult(e);return t.textContent="",t.appendChild(this._renderReport(i)),Util.updateAllUIStrings(n),t}setTemplateContext(e){this._templateContext=e}_renderReportTopbar(e){const t=this._dom.cloneTemplate("#tmpl-lh-topbar",this._templateContext),n=this._dom.find(".lh-topbar__url",t);return n.href=n.textContent=e.finalUrl,n.title=e.finalUrl,t}_renderReportHeader(){const e=this._dom.cloneTemplate("#tmpl-lh-heading",this._templateContext),t=this._dom.cloneTemplate("#tmpl-lh-scores-wrapper",this._templateContext),n=this._dom.find(".lh-scores-wrapper-placeholder",e);return n.parentNode.replaceChild(t,n),e}_renderReportFooter(e){const t=this._dom.cloneTemplate("#tmpl-lh-footer",this._templateContext),n=this._dom.find(".lh-env__items",t);n.id="runtime-settings";const i=Util.getEnvironmentDisplayValues(e.configSettings||{});return[{name:"URL",description:e.finalUrl},{name:"Fetch time",description:Util.formatDateTime(e.fetchTime)},...i,{name:"User agent (host)",description:e.userAgent},{name:"User agent (network)",description:e.environment&&e.environment.networkUserAgent},{name:"CPU/Memory Power",description:e.environment&&e.environment.benchmarkIndex.toFixed(0)}].forEach(e=>{if(!e.description)return;const t=this._dom.cloneTemplate("#tmpl-lh-env__items",n);this._dom.find(".lh-env__name",t).textContent=e.name,this._dom.find(".lh-env__description",t).textContent=e.description,n.appendChild(t)}),this._dom.find(".lh-footer__version",t).textContent=e.lighthouseVersion,t}_renderReportWarnings(e){if(!e.runWarnings||0===e.runWarnings.length)return this._dom.createElement("div");const t=this._dom.cloneTemplate("#tmpl-lh-warnings--toplevel",this._templateContext);this._dom.find(".lh-warnings__msg",t).textContent=Util.UIStrings.toplevelWarningsMessage;const n=this._dom.find("ul",t);for(const t of e.runWarnings){n.appendChild(this._dom.createElement("li")).textContent=t}return t}_renderScoreGauges(e,t,n){const i=[],r=[],s=[];for(const o of Object.values(e.categories)){const a=n[o.id]||t,l=a.renderScoreGauge(o,e.categoryGroups||{});Util.isPluginCategory(o.id)?s.push(l):a.renderScoreGauge===t.renderScoreGauge?i.push(l):r.push(l)}return[...i,...r,...s]}_renderReport(e){const t=new DetailsRenderer(this._dom),n=new CategoryRenderer(this._dom,t);n.setTemplateContext(this._templateContext);const i={performance:new PerformanceCategoryRenderer(this._dom,t),pwa:new PwaCategoryRenderer(this._dom,t)};Object.values(i).forEach(e=>{e.setTemplateContext(this._templateContext)});const r=this._dom.createElement("div");r.appendChild(this._renderReportHeader());const s=this._dom.createElement("div","lh-container"),o=this._dom.createElement("div","lh-report");let a;o.appendChild(this._renderReportWarnings(e));if(1===Object.keys(e.categories).length?r.classList.add("lh-header--solo-category"):a=this._dom.createElement("div","lh-scores-header"),a){const t=this._dom.cloneTemplate("#tmpl-lh-scorescale",this._templateContext),o=this._dom.find(".lh-scores-container",r);a.append(...this._renderScoreGauges(e,n,i)),o.appendChild(a),o.appendChild(t);const l=this._dom.createElement("div","lh-sticky-header");l.append(...this._renderScoreGauges(e,n,i)),s.appendChild(l)}const l=o.appendChild(this._dom.createElement("div","lh-categories"));for(const t of Object.values(e.categories)){const r=i[t.id]||n;r.dom.createChildOf(l,"div","lh-category-wrapper").appendChild(r.render(t,e.categoryGroups))}const d=this._dom.createFragment(),c=this._renderReportTopbar(e);return d.appendChild(c),d.appendChild(s),s.appendChild(r),s.appendChild(o),o.appendChild(this._renderReportFooter(e)),d}}ReportRenderer._UIStringsStash={},"undefined"!=typeof module&&module.exports?module.exports=ReportRenderer:self.ReportRenderer=ReportRenderer;