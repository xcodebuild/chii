import*as Common from"../common/common.js";import*as Host from"../host/host.js";import*as ProtocolClient from"../protocol_client/protocol_client.js";import{GetPropertiesResult,RemoteObject,RemoteObjectImpl,ScopeRef}from"./RemoteObject.js";import{EvaluationOptions,EvaluationResult,ExecutionContext,RuntimeModel}from"./RuntimeModel.js";import{Script}from"./Script.js";import{Capability,SDKModel,Target,Type}from"./SDKModel.js";import{SourceMapManager}from"./SourceMapManager.js";export class DebuggerModel extends SDKModel{constructor(e){super(e),e.registerDebuggerDispatcher(new DebuggerDispatcher(this)),this._agent=e.debuggerAgent(),this._runtimeModel=e.model(RuntimeModel),this._sourceMapManager=new SourceMapManager(e),this._sourceMapIdToScript=new Map,this._debuggerPausedDetails=null,this._scripts=new Map,this._scriptsBySourceURL=new Map,this._discardableScripts=[],this._breakpointResolvedEventTarget=new Common.ObjectWrapper.ObjectWrapper,this._autoStepOver=!1,this._isPausing=!1,Common.Settings.Settings.instance().moduleSetting("pauseOnExceptionEnabled").addChangeListener(this._pauseOnExceptionStateChanged,this),Common.Settings.Settings.instance().moduleSetting("pauseOnCaughtException").addChangeListener(this._pauseOnExceptionStateChanged,this),Common.Settings.Settings.instance().moduleSetting("disableAsyncStackTraces").addChangeListener(this._asyncStackTracesStateChanged,this),Common.Settings.Settings.instance().moduleSetting("breakpointsActive").addChangeListener(this._breakpointsActiveChanged,this),e.suspended()||this._enableDebugger(),this._stringMap=new Map,this._sourceMapManager.setEnabled(Common.Settings.Settings.instance().moduleSetting("jsSourceMapsEnabled").get()),Common.Settings.Settings.instance().moduleSetting("jsSourceMapsEnabled").addChangeListener(e=>this._sourceMapManager.setEnabled(e.data))}static _sourceMapId(e,t,s){return s?e+":"+t+":"+s:null}sourceMapManager(){return this._sourceMapManager}runtimeModel(){return this._runtimeModel}debuggerEnabled(){return!!this._debuggerEnabled}_enableDebugger(){if(this._debuggerEnabled)return Promise.resolve();this._debuggerEnabled=!0;const e=Root.Runtime.queryParam("remoteFrontend")||Root.Runtime.queryParam("ws")?1e7:1e8,t=this._agent.enable(e);return t.then(this._registerDebugger.bind(this)),this._pauseOnExceptionStateChanged(),this._asyncStackTracesStateChanged(),Common.Settings.Settings.instance().moduleSetting("breakpointsActive").get()||this._breakpointsActiveChanged(),DebuggerModel._scheduledPauseOnAsyncCall&&this._pauseOnAsyncCall(DebuggerModel._scheduledPauseOnAsyncCall),this.dispatchEventToListeners(Events.DebuggerWasEnabled,this),t}_registerDebugger(e){e&&(_debuggerIdToModel.set(e,this),this._debuggerId=e,this.dispatchEventToListeners(Events.DebuggerIsReadyToPause,this))}isReadyToPause(){return!!this._debuggerId}static modelForDebuggerId(e){return _debuggerIdToModel.get(e)||null}async _disableDebugger(){if(!this._debuggerEnabled)return Promise.resolve();this._debuggerEnabled=!1,await this._asyncStackTracesStateChanged(),await this._agent.disable(),this._isPausing=!1,this.globalObjectCleared(),this.dispatchEventToListeners(Events.DebuggerWasDisabled),_debuggerIdToModel.delete(this._debuggerId)}_skipAllPauses(e){this._skipAllPausesTimeout&&(clearTimeout(this._skipAllPausesTimeout),delete this._skipAllPausesTimeout),this._agent.setSkipAllPauses(e)}skipAllPausesUntilReloadOrTimeout(e){this._skipAllPausesTimeout&&clearTimeout(this._skipAllPausesTimeout),this._agent.setSkipAllPauses(!0),this._skipAllPausesTimeout=setTimeout(this._skipAllPauses.bind(this,!1),e)}_pauseOnExceptionStateChanged(){let e;e=Common.Settings.Settings.instance().moduleSetting("pauseOnExceptionEnabled").get()?Common.Settings.Settings.instance().moduleSetting("pauseOnCaughtException").get()?PauseOnExceptionsState.PauseOnAllExceptions:PauseOnExceptionsState.PauseOnUncaughtExceptions:PauseOnExceptionsState.DontPauseOnExceptions,this._agent.setPauseOnExceptions(e)}_asyncStackTracesStateChanged(){const e=!Common.Settings.Settings.instance().moduleSetting("disableAsyncStackTraces").get()&&this._debuggerEnabled;return this._agent.setAsyncCallStackDepth(e?32:0)}_breakpointsActiveChanged(){this._agent.setBreakpointsActive(Common.Settings.Settings.instance().moduleSetting("breakpointsActive").get())}stepInto(){this._agent.stepInto()}stepOver(){this._autoStepOver=!0,this._agent.stepOver()}stepOut(){this._agent.stepOut()}scheduleStepIntoAsync(){this._agent.invoke_stepInto({breakOnAsyncCall:!0})}resume(){this._agent.resume(),this._isPausing=!1}pause(){this._isPausing=!0,this._skipAllPauses(!1),this._agent.pause()}_pauseOnAsyncCall(e){return this._agent.invoke_pauseOnAsyncCall({parentStackTraceId:e})}async setBreakpointByURL(e,t,s,r){let o;if(this.target().type()===Type.Node){o=`${Common.ParsedURL.ParsedURL.urlToPlatformPath(e,Host.Platform.isWin()).escapeForRegExp()}|${e.escapeForRegExp()}`}let a=0;const i=this._scriptsBySourceURL.get(e)||[];for(let e=0,s=i.length;e<s;++e){const s=i[e];t===s.lineOffset&&(a=a?Math.min(a,s.columnOffset):s.columnOffset)}s=Math.max(s,a);const n=await this._agent.invoke_setBreakpointByUrl({lineNumber:t,url:o?void 0:e,urlRegex:o,columnNumber:s,condition:r});if(n[ProtocolClient.InspectorBackend.ProtocolError])return{locations:[],breakpointId:null};let c=[];return n.locations&&(c=n.locations.map(e=>Location.fromPayload(this,e))),{locations:c,breakpointId:n.breakpointId}}async setBreakpointInAnonymousScript(e,t,s,r,o){const a=await this._agent.invoke_setBreakpointByUrl({lineNumber:s,scriptHash:t,columnNumber:r,condition:o}),i=a[ProtocolClient.InspectorBackend.ProtocolError];if(i)return"Either url or urlRegex must be specified."!==i?{locations:[],breakpointId:null}:this._setBreakpointBySourceId(e,s,r,o);let n=[];return a.locations&&(n=a.locations.map(e=>Location.fromPayload(this,e))),{locations:n,breakpointId:a.breakpointId}}async _setBreakpointBySourceId(e,t,s,r){const o=await this._agent.invoke_setBreakpoint({location:{scriptId:e,lineNumber:t,columnNumber:s},condition:r});if(o[ProtocolClient.InspectorBackend.ProtocolError])return{breakpointId:null,locations:[]};let a=[];return o.actualLocation&&(a=[Location.fromPayload(this,o.actualLocation)]),{locations:a,breakpointId:o.breakpointId}}async removeBreakpoint(e){const t=await this._agent.invoke_removeBreakpoint({breakpointId:e});t[ProtocolClient.InspectorBackend.ProtocolError]&&console.error("Failed to remove breakpoint: "+t[ProtocolClient.InspectorBackend.ProtocolError])}async getPossibleBreakpoints(e,t,s){const r=await this._agent.invoke_getPossibleBreakpoints({start:e.payload(),end:t?t.payload():void 0,restrictToFunction:s});return r[ProtocolClient.InspectorBackend.ProtocolError]||!r.locations?[]:r.locations.map(e=>BreakLocation.fromPayload(this,e))}async fetchAsyncStackTrace(e){const t=await this._agent.invoke_getStackTrace({stackTraceId:e});return t[ProtocolClient.InspectorBackend.ProtocolError]?null:t.stackTrace}_breakpointResolved(e,t){this._breakpointResolvedEventTarget.dispatchEventToListeners(e,Location.fromPayload(this,t))}globalObjectCleared(){this._setDebuggerPausedDetails(null),this._reset(),this.dispatchEventToListeners(Events.GlobalObjectCleared,this)}_reset(){for(const e of this._sourceMapIdToScript.values())this._sourceMapManager.detachSourceMap(e);this._sourceMapIdToScript.clear(),this._scripts.clear(),this._scriptsBySourceURL.clear(),this._stringMap.clear(),this._discardableScripts=[],this._autoStepOver=!1}scripts(){return Array.from(this._scripts.values())}scriptForId(e){return this._scripts.get(e)||null}scriptsForSourceURL(e){return e&&this._scriptsBySourceURL.get(e)||[]}scriptsForExecutionContext(e){const t=[];for(const s of this._scripts.values())s.executionContextId===e.id&&t.push(s);return t}setScriptSource(e,t,s){this._scripts.get(e).editSource(t,this._didEditScriptSource.bind(this,e,t,s))}_didEditScriptSource(e,t,s,r,o,a,i,n,c){s(r,o),c?this.stepInto():!r&&a&&a.length&&this._pausedScript(a,this._debuggerPausedDetails.reason,this._debuggerPausedDetails.auxData,this._debuggerPausedDetails.breakpointIds,i,n)}get callFrames(){return this._debuggerPausedDetails?this._debuggerPausedDetails.callFrames:null}debuggerPausedDetails(){return this._debuggerPausedDetails}_setDebuggerPausedDetails(e){if(this._isPausing=!1,this._debuggerPausedDetails=e,this._debuggerPausedDetails){if(this._beforePausedCallback&&!this._beforePausedCallback.call(null,this._debuggerPausedDetails))return!1;this._autoStepOver=!1,this.dispatchEventToListeners(Events.DebuggerPaused,this)}return e?this.setSelectedCallFrame(e.callFrames[0]):this.setSelectedCallFrame(null),!0}setBeforePausedCallback(e){this._beforePausedCallback=e}async _pausedScript(e,t,s,r,o,a,i){if(i){DebuggerModel._scheduledPauseOnAsyncCall=i;const e=[];for(const t of _debuggerIdToModel.values())e.push(t._pauseOnAsyncCall(i));return await Promise.all(e),void this.resume()}const n=new DebuggerPausedDetails(this,e,t,s,r,o,a),c=Bindings.debuggerWorkspaceBinding.getLanguagePluginManager(this);if(c)for(const e of n.callFrames)e.sourceScopeChain=await c.resolveScopeChain(e);if(n&&this._continueToLocationCallback){const e=this._continueToLocationCallback;if(delete this._continueToLocationCallback,e(n))return}this._setDebuggerPausedDetails(n)||(this._autoStepOver?this._agent.stepOver():this._agent.stepInto()),DebuggerModel._scheduledPauseOnAsyncCall=null}_resumedScript(){this._setDebuggerPausedDetails(null),this.dispatchEventToListeners(Events.DebuggerResumed,this)}_parsedScriptSource(e,t,s,r,o,a,i,n,c,l,u,d,p,g,h,m,_){if(this._scripts.has(e))return this._scripts.get(e);let b=!1;c&&"isDefault"in c&&(b=!c.isDefault),t=this._internString(t);const S=new Script(this,e,t,s,r,o,a,i,this._internString(n),b,l,u,d,g,h,m,_);this._registerScript(S),this.dispatchEventToListeners(Events.ParsedScriptSource,S);const y=Bindings.debuggerWorkspaceBinding.getLanguagePluginManager(this);if(!Root.Runtime.experiments.isEnabled("wasmDWARFDebugging")||!y||!y.hasPluginForScript(S)){const e=DebuggerModel._sourceMapId(S.executionContextId,S.sourceURL,S.sourceMapURL);if(e&&!p){const t=this._sourceMapIdToScript.get(e);t&&this._sourceMapManager.detachSourceMap(t),this._sourceMapIdToScript.set(e,S),this._sourceMapManager.attachSourceMap(S,S.sourceURL,S.sourceMapURL)}}return p&&S.isAnonymousScript()&&(this._discardableScripts.push(S),this._collectDiscardedScripts()),S}setSourceMapURL(e,t){let s=DebuggerModel._sourceMapId(e.executionContextId,e.sourceURL,e.sourceMapURL);s&&this._sourceMapIdToScript.get(s)===e&&this._sourceMapIdToScript.delete(s),this._sourceMapManager.detachSourceMap(e),e.sourceMapURL=t,s=DebuggerModel._sourceMapId(e.executionContextId,e.sourceURL,e.sourceMapURL),s&&(this._sourceMapIdToScript.set(s,e),this._sourceMapManager.attachSourceMap(e,e.sourceURL,e.sourceMapURL))}executionContextDestroyed(e){const t=Array.from(this._sourceMapIdToScript.keys());for(const s of t){const t=this._sourceMapIdToScript.get(s);t.executionContextId===e.id&&(this._sourceMapIdToScript.delete(s),this._sourceMapManager.detachSourceMap(t))}}_registerScript(e){if(this._scripts.set(e.scriptId,e),e.isAnonymousScript())return;let t=this._scriptsBySourceURL.get(e.sourceURL);t||(t=[],this._scriptsBySourceURL.set(e.sourceURL,t)),t.push(e)}_unregisterScript(e){console.assert(e.isAnonymousScript()),this._scripts.delete(e.scriptId)}_collectDiscardedScripts(){if(this._discardableScripts.length<1e3)return;const e=this._discardableScripts.splice(0,100);for(const t of e)this._unregisterScript(t),this.dispatchEventToListeners(Events.DiscardedAnonymousScriptSource,t)}createRawLocation(e,t,s){return new Location(this,e.scriptId,t,s)}createRawLocationByURL(e,t,s){let r=null;const o=this._scriptsBySourceURL.get(e)||[];for(let e=0,a=o.length;e<a;++e){const a=o[e];if(r||(r=a),!(a.lineOffset>t||a.lineOffset===t&&a.columnOffset>s||a.endLine<t||a.endLine===t&&a.endColumn<=s)){r=a;break}}return r?new Location(this,r.scriptId,t,s):null}createRawLocationByScriptId(e,t,s){const r=this.scriptForId(e);return r?this.createRawLocation(r,t,s):null}createRawLocationsByStackTrace(e){const t=[];for(;e;){for(const s of e.callFrames)t.push(s);e=e.parent}const s=[];for(const e of t){const t=this.createRawLocationByScriptId(e.scriptId,e.lineNumber,e.columnNumber);t&&s.push(t)}return s}isPaused(){return!!this.debuggerPausedDetails()}isPausing(){return this._isPausing}setSelectedCallFrame(e){this._selectedCallFrame!==e&&(this._selectedCallFrame=e,this.dispatchEventToListeners(Events.CallFrameSelected,this))}selectedCallFrame(){return this._selectedCallFrame}evaluateOnSelectedCallFrame(e){return this.selectedCallFrame().evaluate(e)}functionDetailsPromise(e){return e.getAllProperties(!1,!1).then(function(e){if(!e)return null;let t=null;if(e.internalProperties)for(const s of e.internalProperties)"[[FunctionLocation]]"===s.name&&(t=s.value);let s=null;if(e.properties)for(const t of e.properties)if("name"===t.name&&t.value&&"string"===t.value.type&&(s=t.value),"displayName"===t.name&&t.value&&"string"===t.value.type){s=t.value;break}let r=null;t&&(r=this.createRawLocationByScriptId(t.value.scriptId,t.value.lineNumber,t.value.columnNumber));return{location:r,functionName:s?s.value:""}}.bind(this))}async setVariableValue(e,t,s,r){const o=(await this._agent.invoke_setVariableValue({scopeNumber:e,variableName:t,newValue:s,callFrameId:r}))[ProtocolClient.InspectorBackend.ProtocolError];return o&&console.error(o),o}addBreakpointListener(e,t,s){this._breakpointResolvedEventTarget.addEventListener(e,t,s)}removeBreakpointListener(e,t,s){this._breakpointResolvedEventTarget.removeEventListener(e,t,s)}async setBlackboxPatterns(e){const t=(await this._agent.invoke_setBlackboxPatterns({patterns:e}))[ProtocolClient.InspectorBackend.ProtocolError];return t&&console.error(t),!t}dispose(){this._sourceMapManager.dispose(),_debuggerIdToModel.delete(this._debuggerId),Common.Settings.Settings.instance().moduleSetting("pauseOnExceptionEnabled").removeChangeListener(this._pauseOnExceptionStateChanged,this),Common.Settings.Settings.instance().moduleSetting("pauseOnCaughtException").removeChangeListener(this._pauseOnExceptionStateChanged,this),Common.Settings.Settings.instance().moduleSetting("disableAsyncStackTraces").removeChangeListener(this._asyncStackTracesStateChanged,this)}async suspendModel(){await this._disableDebugger()}async resumeModel(){await this._enableDebugger()}_internString(e){return this._stringMap.has(e)||this._stringMap.set(e,e),this._stringMap.get(e)}}export const _debuggerIdToModel=new Map;export const _scheduledPauseOnAsyncCall=null;export const PauseOnExceptionsState={DontPauseOnExceptions:"none",PauseOnAllExceptions:"all",PauseOnUncaughtExceptions:"uncaught"};export const Events={DebuggerWasEnabled:Symbol("DebuggerWasEnabled"),DebuggerWasDisabled:Symbol("DebuggerWasDisabled"),DebuggerPaused:Symbol("DebuggerPaused"),DebuggerResumed:Symbol("DebuggerResumed"),ParsedScriptSource:Symbol("ParsedScriptSource"),FailedToParseScriptSource:Symbol("FailedToParseScriptSource"),DiscardedAnonymousScriptSource:Symbol("DiscardedAnonymousScriptSource"),GlobalObjectCleared:Symbol("GlobalObjectCleared"),CallFrameSelected:Symbol("CallFrameSelected"),ConsoleCommandEvaluatedInSelectedCallFrame:Symbol("ConsoleCommandEvaluatedInSelectedCallFrame"),DebuggerIsReadyToPause:Symbol("DebuggerIsReadyToPause")};export const BreakReason={DOM:"DOM",EventListener:"EventListener",XHR:"XHR",Exception:"exception",PromiseRejection:"promiseRejection",Assert:"assert",DebugCommand:"debugCommand",OOM:"OOM",Other:"other"};const ContinueToLocationTargetCallFrames={Any:"any",Current:"current"};class DebuggerDispatcher{constructor(e){this._debuggerModel=e}paused(e,t,s,r,o,a,i){this._debuggerModel._pausedScript(e,t,s,r||[],o,a,i)}resumed(){this._debuggerModel._resumedScript()}scriptParsed(e,t,s,r,o,a,i,n,c,l,u,d,p,g,h,m,_){this._debuggerModel._parsedScriptSource(e,t,s,r,o,a,i,n,c,!!l,u,!!d,!1,g||0,h||null,m||null,_||null)}scriptFailedToParse(e,t,s,r,o,a,i,n,c,l,u,d,p,g,h,m){this._debuggerModel._parsedScriptSource(e,t,s,r,o,a,i,n,c,!1,l,!!u,!0,p||0,g||null,h||null,m||null)}breakpointResolved(e,t){this._debuggerModel._breakpointResolved(e,t)}}export class Location{constructor(e,t,s,r){this.debuggerModel=e,this.scriptId=t,this.lineNumber=s,this.columnNumber=r||0}static fromPayload(e,t){return new Location(e,t.scriptId,t.lineNumber,t.columnNumber)}payload(){return{scriptId:this.scriptId,lineNumber:this.lineNumber,columnNumber:this.columnNumber}}script(){return this.debuggerModel.scriptForId(this.scriptId)}continueToLocation(e){e&&(this.debuggerModel._continueToLocationCallback=this._paused.bind(this,e)),this.debuggerModel._agent.continueToLocation(this.payload(),ContinueToLocationTargetCallFrames.Current)}_paused(e,t){const s=t.callFrames[0].location();return s.scriptId===this.scriptId&&s.lineNumber===this.lineNumber&&s.columnNumber===this.columnNumber&&(e(),!0)}id(){return this.debuggerModel.target().id()+":"+this.scriptId+":"+this.lineNumber+":"+this.columnNumber}}export class BreakLocation extends Location{constructor(e,t,s,r,o){super(e,t,s,r),o&&(this.type=o)}static fromPayload(e,t){return new BreakLocation(e,t.scriptId,t.lineNumber,t.columnNumber,t.type)}}export class CallFrame{constructor(e,t,s){this.debuggerModel=e,this.sourceScopeChain=null,this._script=t,this._payload=s,this._location=Location.fromPayload(e,s.location),this._scopeChain=[],this._localScope=null;for(let e=0;e<s.scopeChain.length;++e){const t=new Scope(this,e);this._scopeChain.push(t),t.type()===Protocol.Debugger.ScopeType.Local&&(this._localScope=t)}s.functionLocation&&(this._functionLocation=Location.fromPayload(e,s.functionLocation)),this._returnValue=s.returnValue?this.debuggerModel._runtimeModel.createRemoteObject(s.returnValue):null}static fromPayloadArray(e,t){const s=[];for(let r=0;r<t.length;++r){const o=t[r],a=e.scriptForId(o.location.scriptId);a&&s.push(new CallFrame(e,a,o))}return s}get script(){return this._script}get id(){return this._payload.callFrameId}scopeChain(){return this._scopeChain}localScope(){return this._localScope}thisObject(){return this._payload.this?this.debuggerModel._runtimeModel.createRemoteObject(this._payload.this):null}returnValue(){return this._returnValue}async setReturnValue(e){if(!this._returnValue)return null;const t=await this.debuggerModel._agent.invoke_evaluateOnCallFrame({callFrameId:this.id,expression:e,silent:!0,objectGroup:"backtrace"});if(t[ProtocolClient.InspectorBackend.ProtocolError]||t.exceptionDetails)return null;return(await this.debuggerModel._agent.invoke_setReturnValue({newValue:t.result}))[ProtocolClient.InspectorBackend.ProtocolError]?null:(this._returnValue=this.debuggerModel._runtimeModel.createRemoteObject(t.result),this._returnValue)}get functionName(){return this._payload.functionName}location(){return this._location}functionLocation(){return this._functionLocation||null}async evaluate(e){const t=this.debuggerModel.runtimeModel();if((!!e.throwOnSideEffect||void 0!==e.timeout)&&(!1===t.hasSideEffectSupport()||null===t.hasSideEffectSupport()&&!await t.checkSideEffectSupport()))return{error:"Side-effect checks not supported by backend."};const s=await this.debuggerModel._agent.invoke_evaluateOnCallFrame({callFrameId:this.id,expression:e.expression,objectGroup:e.objectGroup,includeCommandLineAPI:e.includeCommandLineAPI,silent:e.silent,returnByValue:e.returnByValue,generatePreview:e.generatePreview,throwOnSideEffect:e.throwOnSideEffect,timeout:e.timeout}),r=s[ProtocolClient.InspectorBackend.ProtocolError];return r?(console.error(r),{error:r}):{object:t.createRemoteObject(s.result),exceptionDetails:s.exceptionDetails}}async restart(){(await this.debuggerModel._agent.invoke_restartFrame({callFrameId:this._payload.callFrameId}))[ProtocolClient.InspectorBackend.ProtocolError]||this.debuggerModel.stepInto()}}export class Scope{constructor(e,t){this._callFrame=e,this._payload=e._payload.scopeChain[t],this._type=this._payload.type,this._name=this._payload.name,this._ordinal=t,this._startLocation=this._payload.startLocation?Location.fromPayload(e.debuggerModel,this._payload.startLocation):null,this._endLocation=this._payload.endLocation?Location.fromPayload(e.debuggerModel,this._payload.endLocation):null}callFrame(){return this._callFrame}type(){return this._type}typeName(){switch(this._type){case Protocol.Debugger.ScopeType.Local:return Common.UIString.UIString("Local");case Protocol.Debugger.ScopeType.Closure:return Common.UIString.UIString("Closure");case Protocol.Debugger.ScopeType.Catch:return Common.UIString.UIString("Catch");case Protocol.Debugger.ScopeType.Block:return Common.UIString.UIString("Block");case Protocol.Debugger.ScopeType.Script:return Common.UIString.UIString("Script");case Protocol.Debugger.ScopeType.With:return Common.UIString.UIString("With Block");case Protocol.Debugger.ScopeType.Global:return Common.UIString.UIString("Global");case Protocol.Debugger.ScopeType.Module:return Common.UIString.UIString("Module");case Protocol.Debugger.ScopeType.WasmExpressionStack:return Common.UIString.UIString("Stack")}return""}name(){return this._name}startLocation(){return this._startLocation}endLocation(){return this._endLocation}object(){if(this._object)return this._object;const e=this._callFrame.debuggerModel._runtimeModel,t=this._type!==Protocol.Debugger.ScopeType.With&&this._type!==Protocol.Debugger.ScopeType.Global;return this._object=t?e.createScopeRemoteObject(this._payload.object,new ScopeRef(this._ordinal,this._callFrame.id)):e.createRemoteObject(this._payload.object),this._object}description(){return this._type!==Protocol.Debugger.ScopeType.With&&this._type!==Protocol.Debugger.ScopeType.Global?"":this._payload.object.description||""}}export class DebuggerPausedDetails{constructor(e,t,s,r,o,a,i){this.debuggerModel=e,this.callFrames=CallFrame.fromPayloadArray(e,t),this.reason=s,this.auxData=r,this.breakpointIds=o,a&&(this.asyncStackTrace=this._cleanRedundantFrames(a)),this.asyncStackTraceId=i}exception(){return this.reason!==BreakReason.Exception&&this.reason!==BreakReason.PromiseRejection?null:this.debuggerModel._runtimeModel.createRemoteObject(this.auxData)}_cleanRedundantFrames(e){let t=e,s=null;for(;t;)"async function"===t.description&&t.callFrames.length&&t.callFrames.shift(),s&&!t.callFrames.length?s.parent=t.parent:s=t,t=t.parent;return e}}SDKModel.register(DebuggerModel,Capability.JS,!0);export let FunctionDetails;export let SetBreakpointResult;