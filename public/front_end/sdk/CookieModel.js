import*as Common from"../common/common.js";import{Attributes,Cookie}from"./Cookie.js";import{Resource}from"./Resource.js";import{ResourceTreeModel}from"./ResourceTreeModel.js";import{Capability,SDKModel,Target}from"./SDKModel.js";export class CookieModel extends SDKModel{constructor(e){super(e),this._blockedCookies=new Map,this._cookieToBlockedReasons=new Map}addBlockedCookie(e,o){const t=e.key(),s=this._blockedCookies.get(t);this._blockedCookies.set(t,e),this._cookieToBlockedReasons.set(e,o),s&&this._cookieToBlockedReasons.delete(t)}getCookieToBlockedReasonsMap(){return this._cookieToBlockedReasons}async getCookies(e){return(await this.target().networkAgent().getCookies(e).then(e=>(e||[]).map(e=>Cookie.fromProtocolCookie(e)))).concat(Array.from(this._blockedCookies.values()))}deleteCookie(e,o){this._deleteAll([e],o)}clear(e,o){this.getCookiesForDomain(e||null).then(e=>this._deleteAll(e,o))}saveCookie(e){let o=e.domain();o.startsWith(".")||(o="");let t=void 0;return e.expires()&&(t=Math.floor(Date.parse(e.expires())/1e3)),this.target().networkAgent().setCookie(e.name(),e.value(),e.url()||void 0,o,e.path(),e.secure(),e.httpOnly(),e.sameSite(),t,e.priority()).then(e=>!!e)}getCookiesForDomain(e){const o=[];const t=this.target().model(ResourceTreeModel);return t&&(t.mainFrame.unreachableUrl()&&o.push(t.mainFrame.unreachableUrl()),t.forAllResources((function(t){const s=Common.ParsedURL.ParsedURL.fromString(t.documentURL);!s||e&&s.securityOrigin()!==e||o.push(t.url)}))),this.getCookies(o)}_deleteAll(e,o){const t=this.target().networkAgent();this._blockedCookies.clear(),this._cookieToBlockedReasons.clear(),Promise.all(e.map(e=>t.deleteCookies(e.name(),void 0,e.domain(),e.path()))).then(o||function(){})}}SDKModel.register(CookieModel,Capability.Network,!1);export let BlockedReason;