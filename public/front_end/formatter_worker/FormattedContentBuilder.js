export class FormattedContentBuilder{constructor(t){this._lastOriginalPosition=0,this._formattedContent=[],this._formattedContentLength=0,this._lastFormattedPosition=0,this._mapping={original:[0],formatted:[0]},this._nestingLevel=0,this._indentString=t,this._cachedIndents=new Map,this._newLines=0,this._softSpace=!1,this._hardSpaces=0,this._enforceSpaceBetweenWords=!0}setEnforceSpaceBetweenWords(t){const e=this._enforceSpaceBetweenWords;return this._enforceSpaceBetweenWords=t,e}addToken(t,e){const s=this._formattedContent.peekLast();this._enforceSpaceBetweenWords&&s&&/\w/.test(s[s.length-1])&&/\w/.test(t)&&this.addSoftSpace(),this._appendFormatting(),this._addMappingIfNeeded(e),this._addText(t)}addSoftSpace(){this._hardSpaces||(this._softSpace=!0)}addHardSpace(){this._softSpace=!1,++this._hardSpaces}addNewLine(t){this._formattedContentLength&&(t?++this._newLines:this._newLines=this._newLines||1)}increaseNestingLevel(){this._nestingLevel+=1}decreaseNestingLevel(){this._nestingLevel>0&&(this._nestingLevel-=1)}_appendFormatting(){if(this._newLines){for(let t=0;t<this._newLines;++t)this._addText("\n");this._addText(this._indent())}else this._softSpace&&this._addText(" ");if(this._hardSpaces)for(let t=0;t<this._hardSpaces;++t)this._addText(" ");this._newLines=0,this._softSpace=!1,this._hardSpaces=0}content(){return this._formattedContent.join("")+(this._newLines?"\n":"")}mapping(){return this._mapping}_indent(){const t=this._cachedIndents.get(this._nestingLevel);if(t)return t;let e="";for(let t=0;t<this._nestingLevel;++t)e+=this._indentString;return this._nestingLevel<=20&&this._cachedIndents.set(this._nestingLevel,e),e}_addText(t){this._formattedContent.push(t),this._formattedContentLength+=t.length}_addMappingIfNeeded(t){t-this._lastOriginalPosition!=this._formattedContentLength-this._lastFormattedPosition&&(this._mapping.original.push(t),this._lastOriginalPosition=t,this._mapping.formatted.push(this._formattedContentLength),this._lastFormattedPosition=this._formattedContentLength)}}