import*as TextEditor from"../text_editor/text_editor.js";import*as UI from"../ui/ui.js";import{Row,RowType}from"./ChangesView.js";export class ChangesTextEditor extends TextEditor.CodeMirrorTextEditor.CodeMirrorTextEditor{constructor(e){e.inputStyle="devToolsAccessibleDiffTextArea",super(e),this.codeMirror().setOption("gutters",["CodeMirror-linenumbers","changes-diff-gutter"]),this.codeMirror().setOption("extraKeys",{Enter:!1,Space:!1,Left:function(e){const t=e.getScrollInfo();t.left>0&&e.scrollTo(t.left-Math.round(t.clientWidth/6),null)},Right:function(e){const t=e.getScrollInfo();e.scrollTo(t.left+Math.round(t.clientWidth/6),null)}})}updateDiffGutter(e){this.codeMirror().eachLine(t=>{const r=this.codeMirror().getLineNumber(t),o=e[r];let i;o.type===RowType.Deletion?(i=createElementWithClass("div","deletion changes-diff-gutter-marker"),i.textContent="-"):o.type===RowType.Addition&&(i=createElementWithClass("div","addition changes-diff-gutter-marker"),i.textContent="+"),i&&this.codeMirror().setGutterMarker(t,"changes-diff-gutter",i)})}}export class DevToolsAccessibleDiffTextArea extends CodeMirror.inputStyles.devToolsAccessibleTextArea{reset(e){if(super.reset(e),this.textAreaBusy(!!e)||"object"!=typeof this.cm.doc.modeOption)return;const t=this.cm.doc.modeOption.diffRows[this.cm.getCursor().line].type;t===RowType.Deletion&&(this.textarea.value=ls`Deletion:${this.textarea.value}`),t===RowType.Addition&&(this.textarea.value=ls`Addition:${this.textarea.value}`),this.prevInput=this.textarea.value}}CodeMirror.inputStyles.devToolsAccessibleDiffTextArea=DevToolsAccessibleDiffTextArea;